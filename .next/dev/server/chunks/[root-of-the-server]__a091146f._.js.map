{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///home/user/EduPack-new-interface/app/api/scorm/export/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport JSZip from 'jszip';\nimport { EditorProject } from '@/lib/scorm/types';\nimport { promises as fs } from 'fs';\nimport path from 'path';\n\n// Helper function to read template files\nasync function getTemplateFile(filePath: string): Promise<string> {\n  const absolutePath = path.join(process.cwd(), 'lib/scorm/templates/scorm2004', filePath);\n  return fs.readFile(absolutePath, 'utf-8');\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const project = await req.json() as EditorProject;\n\n    const zip = new JSZip();\n\n    // Add all XSD files to the zip\n    const xsdFiles = ['imscp_v1p1.xsd', 'adlcp_v1p3.xsd', 'adlnav_v1p3.xsd', 'adlseq_v1p3.xsd', 'imsss_v1p0.xsd', 'xml.xsd'];\n    for (const xsdFile of xsdFiles) {\n        zip.file(xsdFile, await getTemplateFile(xsdFile));\n    }\n\n    // Create and configure imsmanifest.xml\n    let manifest = await getTemplateFile('imsmanifest.xml');\n    manifest = manifest.replace(/\\\\[\\\\[IDENTIFIER\\\\]\\\\]/g, project.id)\n                       .replace(/\\\\[\\\\[TITLE\\\\]\\\\]/g, project.title)\n                       .replace(/\\\\[\\\\[ORGANIZATION_ID\\\\]\\\\]/g, `${project.id}-org`)\n                       .replace(/\\\\[\\\\[FILES\\\\]\\\\]/g, '<file href=\"index.html\" />');\n\n    zip.file('imsmanifest.xml', manifest);\n\n    // Generate and add index.html\n    const htmlContent = `\n      <!DOCTYPE html>\n      <html lang=\"${project.language || 'en'}\">\n      <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>${project.title}</title>\n        <script>\n          // Mock SCORM API for demonstration purposes\n          var API = {\n            LMSInitialize: function() { console.log('LMSInitialize'); return 'true'; },\n            LMSFinish: function() { console.log('LMSFinish'); return 'true'; },\n            LMSGetValue: function(name) { console.log('LMSGetValue', name); return ''; },\n            LMSSetValue: function(name, value) { console.log('LMSSetValue', name, value); return 'true'; },\n            LMSCommit: function() { console.log('LMSCommit'); return 'true'; },\n            LMSGetLastError: function() { console.log('LMSGetLastError'); return '0'; },\n            LMSGetErrorString: function(code) { console.log('LMSGetErrorString', code); return 'No error'; },\n            LMSGetDiagnostic: function(code) { console.log('LMSGetDiagnostic', code); return 'No error'; },\n          };\n        </script>\n      </head>\n      <body>\n        <h1>${project.title}</h1>\n        ${project.pages.map(page => `\n          <article>\n            <h2>${page.title}</h2>\n            ${page.blocks.map(block => {\n              switch (block.type) {\n                case 'text': return block.html;\n                case 'image': return `<figure><img src=\"${block.src}\" alt=\"${block.alt || ''}\"><figcaption>${block.alt || ''}</figcaption></figure>`;\n                case 'video': return `<video src=\"${block.src}\" controls></video>`;\n                case 'quiz': return `\n                  <form>\n                    <fieldset>\n                      <legend>${block.question}</legend>\n                      ${block.options.map(o => `\n                        <div>\n                          <input type=\"radio\" id=\"${o.id}\" name=\"${block.id}\" value=\"${o.id}\">\n                          <label for=\"${o.id}\">${o.label}</label>\n                        </div>\n                      `).join('')}\n                    </fieldset>\n                  </form>\n                `;\n                default: return '';\n              }\n            }).join('')}\n          </article>\n        `).join('')}\n      </body>\n      </html>\n    `;\n\n    zip.file('index.html', htmlContent);\n\n    const zipBuffer = await zip.generateAsync({ type: 'nodebuffer' });\n\n    return new NextResponse(zipBuffer, {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/zip',\n        'Content-Disposition': `attachment; filename=\"${project.title.replace(/ /g, '_')}.zip\"`,\n      },\n    });\n\n  } catch (error) {\n    console.error('Error creating SCORM package:', error);\n    return new NextResponse('Error creating SCORM package', { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;AACA;;;;;AAEA,yCAAyC;AACzC,eAAe,gBAAgB,QAAgB;IAC7C,MAAM,eAAe,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,iCAAiC;IAC/E,OAAO,yGAAE,CAAC,QAAQ,CAAC,cAAc;AACnC;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,UAAU,MAAM,IAAI,IAAI;QAE9B,MAAM,MAAM,IAAI,kJAAK;QAErB,+BAA+B;QAC/B,MAAM,WAAW;YAAC;YAAkB;YAAkB;YAAmB;YAAmB;YAAkB;SAAU;QACxH,KAAK,MAAM,WAAW,SAAU;YAC5B,IAAI,IAAI,CAAC,SAAS,MAAM,gBAAgB;QAC5C;QAEA,uCAAuC;QACvC,IAAI,WAAW,MAAM,gBAAgB;QACrC,WAAW,SAAS,OAAO,CAAC,2BAA2B,QAAQ,EAAE,EAC7C,OAAO,CAAC,sBAAsB,QAAQ,KAAK,EAC3C,OAAO,CAAC,gCAAgC,GAAG,QAAQ,EAAE,CAAC,IAAI,CAAC,EAC3D,OAAO,CAAC,sBAAsB;QAElD,IAAI,IAAI,CAAC,mBAAmB;QAE5B,8BAA8B;QAC9B,MAAM,cAAc,CAAC;;kBAEP,EAAE,QAAQ,QAAQ,IAAI,KAAK;;;;eAI9B,EAAE,QAAQ,KAAK,CAAC;;;;;;;;;;;;;;;;YAgBnB,EAAE,QAAQ,KAAK,CAAC;QACpB,EAAE,QAAQ,KAAK,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC;;gBAErB,EAAE,KAAK,KAAK,CAAC;YACjB,EAAE,KAAK,MAAM,CAAC,GAAG,CAAC,CAAA;gBAChB,OAAQ,MAAM,IAAI;oBAChB,KAAK;wBAAQ,OAAO,MAAM,IAAI;oBAC9B,KAAK;wBAAS,OAAO,CAAC,kBAAkB,EAAE,MAAM,GAAG,CAAC,OAAO,EAAE,MAAM,GAAG,IAAI,GAAG,cAAc,EAAE,MAAM,GAAG,IAAI,GAAG,sBAAsB,CAAC;oBACpI,KAAK;wBAAS,OAAO,CAAC,YAAY,EAAE,MAAM,GAAG,CAAC,mBAAmB,CAAC;oBAClE,KAAK;wBAAQ,OAAO,CAAC;;;8BAGP,EAAE,MAAM,QAAQ,CAAC;sBACzB,EAAE,MAAM,OAAO,CAAC,GAAG,CAAC,CAAA,IAAK,CAAC;;kDAEE,EAAE,EAAE,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,CAAC,SAAS,EAAE,EAAE,EAAE,CAAC;sCACtD,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,KAAK,CAAC;;sBAEnC,CAAC,EAAE,IAAI,CAAC,IAAI;;;gBAGlB,CAAC;oBACD;wBAAS,OAAO;gBAClB;YACF,GAAG,IAAI,CAAC,IAAI;;QAEhB,CAAC,EAAE,IAAI,CAAC,IAAI;;;IAGhB,CAAC;QAED,IAAI,IAAI,CAAC,cAAc;QAEvB,MAAM,YAAY,MAAM,IAAI,aAAa,CAAC;YAAE,MAAM;QAAa;QAE/D,OAAO,IAAI,gJAAY,CAAC,WAAW;YACjC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,sBAAsB,EAAE,QAAQ,KAAK,CAAC,OAAO,CAAC,MAAM,KAAK,KAAK,CAAC;YACzF;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,IAAI,gJAAY,CAAC,gCAAgC;YAAE,QAAQ;QAAI;IACxE;AACF"}}]
}