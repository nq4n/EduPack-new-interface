{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/supabase/server.ts"],"sourcesContent":["// lib/supabase/server.ts\r\nimport { createServerClient, type CookieOptions } from \"@supabase/ssr\";\r\nimport { cookies } from \"next/headers\";\r\n\r\n// âš ï¸ IMPORTANT: this is async now\r\nexport async function createClient() {\r\n  const cookieStore = await cookies();\r\n\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\n  if (!supabaseUrl || !supabaseAnonKey) {\r\n    throw new Error(\r\n      \"Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\"\r\n    );\r\n  }\r\n\r\n  return createServerClient(supabaseUrl, supabaseAnonKey, {\r\n    cookies: {\r\n      // Next.js + @supabase/ssr expect getAll/setAll, NOT get/set/remove\r\n      getAll() {\r\n        return cookieStore.getAll();\r\n      },\r\n      setAll(cookiesToSet: { name: string; value: string; options: CookieOptions }[]) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) => {\r\n            cookieStore.set(name, value, options);\r\n          });\r\n        } catch {\r\n          // Called from a Server Component â€“ it's okay to ignore writes here\r\n          // if you also have middleware handling session refresh.\r\n        }\r\n      },\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":"AAAA,yBAAyB;;;;;AACzB;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM;IACN,MAAM;IAEN;;IAMA,OAAO,IAAA,iMAAkB,EAAC,aAAa,iBAAiB;QACtD,SAAS;YACP,mEAAmE;YACnE;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAuE;gBAC5E,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAM;gBACN,mEAAmE;gBACnE,wDAAwD;gBAC1D;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/app/api/scorm/save/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { randomUUID } from \"crypto\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const supabase = await createClient(); // ðŸ‘ˆ IMPORTANT\r\n\r\n    const {\r\n      data: { user },\r\n      error: userError,\r\n    } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return NextResponse.json(\r\n        { error: \"You must be logged in to save a package.\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const project = await req.json();\r\n\r\n    if (!project || !project.title) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid project data (missing title).\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const packageId: string =\r\n      typeof project.id === \"string\" && project.id.trim().length > 0\r\n        ? project.id\r\n        : randomUUID();\r\n\r\n    const safeTitle =\r\n      (project.title as string)\r\n        ?.toString()\r\n        .toLowerCase()\r\n        .replace(/[^a-z0-9]+/gi, \"-\")\r\n        .replace(/^-+|-+$/g, \"\") || \"package\";\r\n\r\n    const filePath = `${user.id}/${packageId}-${safeTitle}.json`;\r\n\r\n    const fileContent = JSON.stringify(\r\n      {\r\n        ...project,\r\n        id: packageId,\r\n        owner_id: user.id,\r\n        saved_at: new Date().toISOString(),\r\n      },\r\n      null,\r\n      2\r\n    );\r\n\r\n    const bucketName = \"packages\";\r\n\r\n    const { error: storageError } = await supabase.storage\r\n      .from(bucketName)\r\n      .upload(filePath, fileContent, {\r\n        contentType: \"application/json\",\r\n        upsert: true,\r\n      });\r\n\r\n    if (storageError) {\r\n      console.error(\"Error saving package to bucket:\", storageError);\r\n      return NextResponse.json(\r\n        { error: \"Failed to save package to storage.\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      {\r\n        data: {\r\n          package_id: packageId,\r\n          path: filePath,\r\n          bucket: bucketName,\r\n        },\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (err: any) {\r\n    console.error(\"Unexpected error in /api/scorm/save:\", err);\r\n    return NextResponse.json(\r\n      { error: err?.message ?? \"Unexpected error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY,KAAI,eAAe;QAEtD,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACd,OAAO,SAAS,EACjB,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE/B,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,MAAM,IAAI,IAAI;QAE9B,IAAI,CAAC,WAAW,CAAC,QAAQ,KAAK,EAAE;YAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwC,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,YACJ,OAAO,QAAQ,EAAE,KAAK,YAAY,QAAQ,EAAE,CAAC,IAAI,GAAG,MAAM,GAAG,IACzD,QAAQ,EAAE,GACV,IAAA,mHAAU;QAEhB,MAAM,YACJ,AAAC,QAAQ,KAAK,EACV,WACD,cACA,QAAQ,gBAAgB,KACxB,QAAQ,YAAY,OAAO;QAEhC,MAAM,WAAW,GAAG,KAAK,EAAE,CAAC,CAAC,EAAE,UAAU,CAAC,EAAE,UAAU,KAAK,CAAC;QAE5D,MAAM,cAAc,KAAK,SAAS,CAChC;YACE,GAAG,OAAO;YACV,IAAI;YACJ,UAAU,KAAK,EAAE;YACjB,UAAU,IAAI,OAAO,WAAW;QAClC,GACA,MACA;QAGF,MAAM,aAAa;QAEnB,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAAS,OAAO,CACnD,IAAI,CAAC,YACL,MAAM,CAAC,UAAU,aAAa;YAC7B,aAAa;YACb,QAAQ;QACV;QAEF,IAAI,cAAc;YAChB,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,MAAM;gBACJ,YAAY;gBACZ,MAAM;gBACN,QAAQ;YACV;QACF,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,KAAU;QACjB,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,KAAK,WAAW;QAAmB,GAC5C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}