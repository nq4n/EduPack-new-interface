{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/utils/openrouter.ts"],"sourcesContent":["// lib/ai/utils/openrouter.ts\r\nimport OpenAI from \"openai\";\r\n\r\nexport function getOpenRouterClient() {\r\n  return new OpenAI({\r\n    baseURL: \"https://openrouter.ai/api/v1\",\r\n    apiKey: process.env.OPENROUTER_API_KEY!, // ✅ FIXED: server-side env var\r\n    defaultHeaders: {\r\n      \"HTTP-Referer\": process.env.APP_DOMAIN || \"http://localhost:3000\",\r\n      \"X-Title\": \"EduPack SCORM AI\",\r\n    }\r\n  });\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;AAC7B;AAAA;;AAEO,SAAS;IACd,OAAO,IAAI,mLAAM,CAAC;QAChB,SAAS;QACT,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;QACtC,gBAAgB;YACd,gBAAgB,QAAQ,GAAG,CAAC,UAAU,IAAI;YAC1C,WAAW;QACb;IACF;AACF"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/agents/mentor.ts"],"sourcesContent":["// lib/ai/agents/mentor.ts\r\n\r\nimport { getOpenRouterClient } from \"../utils/openrouter\";\r\n\r\n// Use the shared OpenRouter client with correct API key + headers\r\nconst client = getOpenRouterClient();\r\n\r\n/**\r\n * Mentor Stage\r\n * Reads chat messages → Extracts intent → Produces a lesson outline.\r\n *\r\n * Output: plain text outline (NOT JSON)\r\n */\r\nexport async function mentorStage(messages: any[]) {\r\n  const systemPrompt = `\r\nYou are an expert instructional designer and teacher mentor.\r\n\r\nYour task:\r\n1. Read the ENTIRE conversation history.\r\n2. Understand the teacher’s goal:\r\n   - Subject\r\n   - Grade level\r\n   - Learning objectives\r\n   - Activity style\r\n3. Produce a clean, simple, structured lesson outline.\r\n\r\nOUTPUT FORMAT (strict):\r\n\r\nLesson Topic: <topic>\r\n\r\nGrade Level: <grade or \"not specified\">\r\n\r\nLearning Objectives:\r\n- Objective 1\r\n- Objective 2\r\n- Objective 3\r\n\r\nLesson Outline:\r\n1. Introduction\r\n2. Concept Explanation\r\n3. Guided Practice\r\n4. Independent Practice\r\n5. Assessment\r\n6. Conclusion\r\n\r\nRULES:\r\n- DO NOT output JSON.\r\n- DO NOT create SCORM blocks.\r\n- DO NOT generate IDs.\r\n- Keep the outline readable and teacher-friendly.\r\n- The architect agent will turn this into a SCORM blueprint.\r\n`;\r\n\r\n  const response = await client.chat.completions.create({\r\n    model: \"allenai/olmo-3-32b:think\", // Free, excellent reasoning\r\n    messages: [\r\n      { role: \"system\", content: systemPrompt },\r\n      ...messages.map((m) => ({\r\n        role: m.role,\r\n        content: m.content,\r\n      })),\r\n    ],\r\n    temperature: 0.4,\r\n  });\r\n\r\n  return response.choices[0].message.content;\r\n}\r\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;AAE1B;;AAEA,kEAAkE;AAClE,MAAM,SAAS,IAAA,yJAAmB;AAQ3B,eAAe,YAAY,QAAe;IAC/C,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCxB,CAAC;IAEC,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QACpD,OAAO;QACP,UAAU;YACR;gBAAE,MAAM;gBAAU,SAAS;YAAa;eACrC,SAAS,GAAG,CAAC,CAAC,IAAM,CAAC;oBACtB,MAAM,EAAE,IAAI;oBACZ,SAAS,EAAE,OAAO;gBACpB,CAAC;SACF;QACD,aAAa;IACf;IAEA,OAAO,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;AAC5C"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/agents/architect.ts"],"sourcesContent":["// lib/ai/agents/architect.ts\r\n\r\nimport { getOpenRouterClient } from \"../utils/openrouter\";\r\n\r\n// Use shared OpenRouter client\r\nconst client = getOpenRouterClient();\r\n\r\n/**\r\n * Architect Stage\r\n * Converts mentor outline → SCORM lesson blueprint (text only).\r\n *\r\n * Output: structured NATURAL LANGUAGE (NOT JSON).\r\n */\r\nexport async function architectStage(outline: string) {\r\n  const systemPrompt = `\r\nYou are a SCORM lesson architect.\r\n\r\nYour job:\r\nConvert the mentor’s lesson outline into a structured SCORM lesson blueprint.\r\n\r\nOUTPUT FORMAT (very important):\r\n\r\nLesson Title: <title>\r\n\r\nPages:\r\n- Page 1: <title>\r\n  Blocks:\r\n    - Text: <intro or explanation>\r\n    - Image: <placeholder description>\r\n\r\n- Page 2: <concept section>\r\n  Blocks:\r\n    - Text: <details>\r\n    - Quiz:\r\n        type: mcq\r\n        question: <question>\r\n        options: [A, B, C, D]\r\n        answer: <letter>\r\n\r\n- Page 3: Guided Practice\r\n  Blocks:\r\n    - Text: <task instructions>\r\n\r\n- Page 4: Independent Practice\r\n  Blocks:\r\n    - Text: <exercise>\r\n\r\n- Page 5: Conclusion\r\n  Blocks:\r\n    - Text: <summary>\r\n\r\nRULES:\r\n- DO NOT generate JSON.\r\n- DO NOT generate IDs.\r\n- DO NOT embed code or HTML.\r\n- Normalizer will convert this into structured SCORM blocks.\r\n- Keep blueprint clean, simple, and consistent.\r\n`;\r\n\r\n  const response = await client.chat.completions.create({\r\n    model: \"Kwai-KAT-6B:free\", // free, reliable structure\r\n    messages: [\r\n      { role: \"system\", content: systemPrompt },\r\n      { role: \"user\", content: outline }\r\n    ],\r\n    temperature: 0.3,\r\n  });\r\n\r\n  return response.choices[0].message.content;\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;AAE7B;;AAEA,+BAA+B;AAC/B,MAAM,SAAS,IAAA,yJAAmB;AAQ3B,eAAe,eAAe,OAAe;IAClD,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CxB,CAAC;IAEC,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QACpD,OAAO;QACP,UAAU;YACR;gBAAE,MAAM;gBAAU,SAAS;YAAa;YACxC;gBAAE,MAAM;gBAAQ,SAAS;YAAQ;SAClC;QACD,aAAa;IACf;IAEA,OAAO,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;AAC5C"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/agents/deepresearch.ts"],"sourcesContent":["// lib/ai/agents/deepresearch.ts\r\n\r\nimport { getOpenRouterClient } from \"../utils/openrouter\";\r\n\r\n// Use shared OpenRouter client with required headers\r\nconst client = getOpenRouterClient();\r\n\r\n/**\r\n * Deep Research Stage\r\n * Enriches the architect blueprint with:\r\n * - explanations\r\n * - examples\r\n * - guided practice\r\n * - independent tasks\r\n * - differentiation notes\r\n * \r\n * Output: enriched NATURAL LANGUAGE (NOT JSON).\r\n */\r\nexport async function deepResearchStage(blueprint: string) {\r\n  const systemPrompt = `\r\nYou are an advanced education specialist.\r\n\r\nYour task:\r\nTake the architect's lesson blueprint and enrich it with:\r\n\r\n- Clear, simple explanations\r\n- Real classroom examples\r\n- Guided practice steps\r\n- Independent practice tasks\r\n- Optional hints\r\n- Teacher notes for differentiation\r\n- Small embedded assessments\r\n\r\nRules:\r\n- DO NOT output JSON.\r\n- DO NOT modify the page/block structure.\r\n- Only enrich content inside each block.\r\n- Keep paragraphs short and teacher-friendly.\r\n- The normalizer will convert this into SCORM JSON later.\r\n`;\r\n\r\n  const response = await client.chat.completions.create({\r\n    model: \"Kwai-KAT-6B:free\", // Free & strong at structured reasoning\r\n    messages: [\r\n      { role: \"system\", content: systemPrompt },\r\n      { role: \"user\", content: blueprint }\r\n    ],\r\n    temperature: 0.4,\r\n  });\r\n\r\n  return response.choices[0].message.content;\r\n}\r\n"],"names":[],"mappings":"AAAA,gCAAgC;;;;;AAEhC;;AAEA,qDAAqD;AACrD,MAAM,SAAS,IAAA,yJAAmB;AAa3B,eAAe,kBAAkB,SAAiB;IACvD,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;AAoBxB,CAAC;IAEC,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QACpD,OAAO;QACP,UAAU;YACR;gBAAE,MAAM;gBAAU,SAAS;YAAa;YACxC;gBAAE,MAAM;gBAAQ,SAAS;YAAU;SACpC;QACD,aAAa;IACf;IAEA,OAAO,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;AAC5C"}},
    {"offset": {"line": 261, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/utils/normalize.ts"],"sourcesContent":["// lib/ai/utils/normalize.ts\r\n\r\n/**\r\n * Normalizes the Architect / DeepResearch output into\r\n * a clean intermediate lesson structure.\r\n *\r\n * This is NOT yet the final SCORM EditorProject.\r\n */\r\n\r\nexport interface NormalizedBlock {\r\n  type: \"text\" | \"image\" | \"quiz\";\r\n  content?: string;\r\n  src?: string;\r\n  options?: string[];\r\n  answer?: string;\r\n}\r\n\r\nexport interface NormalizedPage {\r\n  title: string;\r\n  blocks: NormalizedBlock[];\r\n}\r\n\r\nexport interface NormalizedLesson {\r\n  title: string;\r\n  pages: NormalizedPage[];\r\n}\r\n\r\nexport function normalizeLesson(raw: string): NormalizedLesson {\r\n  const lines = raw.split(\"\\n\").map(l => l.trim());\r\n  let title = \"Untitled Lesson\";\r\n  const pages: NormalizedPage[] = [];\r\n\r\n  let currentPage: NormalizedPage | null = null;\r\n\r\n  for (const line of lines) {\r\n    // Capture lesson title\r\n    if (line.startsWith(\"Lesson Title:\")) {\r\n      title = line.replace(\"Lesson Title:\", \"\").trim();\r\n      continue;\r\n    }\r\n\r\n    // Detect new page\r\n    if (line.startsWith(\"- Page\")) {\r\n      if (currentPage) pages.push(currentPage);\r\n\r\n      const pageTitle = line.replace(/- Page \\d+:\\s*/i, \"\").trim();\r\n      currentPage = {\r\n        title: pageTitle || \"Untitled Page\",\r\n        blocks: []\r\n      };\r\n      continue;\r\n    }\r\n\r\n    // Detect text block\r\n    if (line.startsWith(\"- Text:\")) {\r\n      const content = line.replace(\"- Text:\", \"\").trim();\r\n      currentPage?.blocks.push({\r\n        type: \"text\",\r\n        content: content || \"\"\r\n      });\r\n      continue;\r\n    }\r\n\r\n    // Detect image block\r\n    if (line.startsWith(\"- Image:\")) {\r\n      const desc = line.replace(\"- Image:\", \"\").trim();\r\n      currentPage?.blocks.push({\r\n        type: \"image\",\r\n        src: \"\", // set in final stage\r\n        content: desc\r\n      });\r\n      continue;\r\n    }\r\n\r\n    // Detect quiz block\r\n    if (line.startsWith(\"- Quiz:\")) {\r\n      // placeholder quiz – refined later\r\n      currentPage?.blocks.push({\r\n        type: \"quiz\",\r\n        content: \"quiz-placeholder\"\r\n      });\r\n      continue;\r\n    }\r\n  }\r\n\r\n  // Push last page\r\n  if (currentPage) pages.push(currentPage);\r\n\r\n  return {\r\n    title,\r\n    pages\r\n  };\r\n}\r\n"],"names":[],"mappings":"AAAA,4BAA4B;AAE5B;;;;;CAKC;;;;AAoBM,SAAS,gBAAgB,GAAW;IACzC,MAAM,QAAQ,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;IAC7C,IAAI,QAAQ;IACZ,MAAM,QAA0B,EAAE;IAElC,IAAI,cAAqC;IAEzC,KAAK,MAAM,QAAQ,MAAO;QACxB,uBAAuB;QACvB,IAAI,KAAK,UAAU,CAAC,kBAAkB;YACpC,QAAQ,KAAK,OAAO,CAAC,iBAAiB,IAAI,IAAI;YAC9C;QACF;QAEA,kBAAkB;QAClB,IAAI,KAAK,UAAU,CAAC,WAAW;YAC7B,IAAI,aAAa,MAAM,IAAI,CAAC;YAE5B,MAAM,YAAY,KAAK,OAAO,CAAC,mBAAmB,IAAI,IAAI;YAC1D,cAAc;gBACZ,OAAO,aAAa;gBACpB,QAAQ,EAAE;YACZ;YACA;QACF;QAEA,oBAAoB;QACpB,IAAI,KAAK,UAAU,CAAC,YAAY;YAC9B,MAAM,UAAU,KAAK,OAAO,CAAC,WAAW,IAAI,IAAI;YAChD,aAAa,OAAO,KAAK;gBACvB,MAAM;gBACN,SAAS,WAAW;YACtB;YACA;QACF;QAEA,qBAAqB;QACrB,IAAI,KAAK,UAAU,CAAC,aAAa;YAC/B,MAAM,OAAO,KAAK,OAAO,CAAC,YAAY,IAAI,IAAI;YAC9C,aAAa,OAAO,KAAK;gBACvB,MAAM;gBACN,KAAK;gBACL,SAAS;YACX;YACA;QACF;QAEA,oBAAoB;QACpB,IAAI,KAAK,UAAU,CAAC,YAAY;YAC9B,mCAAmC;YACnC,aAAa,OAAO,KAAK;gBACvB,MAAM;gBACN,SAAS;YACX;YACA;QACF;IACF;IAEA,iBAAiB;IACjB,IAAI,aAAa,MAAM,IAAI,CAAC;IAE5B,OAAO;QACL;QACA;IACF;AACF"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/utils/sanitize.ts"],"sourcesContent":["// lib/ai/utils/sanitize.ts\r\n\r\nexport function sanitizeText(input: string): string {\r\n  if (!input) return \"\";\r\n  return input\r\n    .replace(/\\r/g, \"\")\r\n    .replace(/\\t/g, \" \")\r\n    .replace(/[<>]/g, \"\") // remove HTML tags if AI adds them\r\n    .replace(/\\s+/g, \" \")\r\n    .trim();\r\n}\r\n\r\nexport function sanitizeBlockContent(content: any): any {\r\n  if (typeof content === \"string\") return sanitizeText(content);\r\n  return content;\r\n}\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;;;AAEpB,SAAS,aAAa,KAAa;IACxC,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,MACJ,OAAO,CAAC,OAAO,IACf,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,SAAS,IAAI,mCAAmC;KACxD,OAAO,CAAC,QAAQ,KAChB,IAAI;AACT;AAEO,SAAS,qBAAqB,OAAY;IAC/C,IAAI,OAAO,YAAY,UAAU,OAAO,aAAa;IACrD,OAAO;AACT"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/ai-schema.ts"],"sourcesContent":["// lib/ai/ai-schema.ts\r\nimport { z } from \"zod\";\r\n\r\n/**\r\n * --------------------------\r\n * Block Schemas\r\n * --------------------------\r\n */\r\n\r\nconst TextBlockSchema = z.object({\r\n  type: z.literal(\"text\"),\r\n  id: z.string(),\r\n  html: z.string().default(\"\"),\r\n  style: z.any().optional(),\r\n});\r\n\r\nconst ImageBlockSchema = z.object({\r\n  type: z.literal(\"image\"),\r\n  id: z.string(),\r\n  src: z.string().default(\"\"),\r\n  alt: z.string().optional(),\r\n});\r\n\r\nconst VideoBlockSchema = z.object({\r\n  type: z.literal(\"video\"),\r\n  id: z.string(),\r\n  src: z.string().default(\"\"),\r\n});\r\n\r\nconst QuizOptionSchema = z.object({\r\n  id: z.string(),\r\n  label: z.string(),\r\n  correct: z.boolean().optional(),\r\n});\r\n\r\nconst QuizBlockSchema = z.object({\r\n  type: z.literal(\"quiz\"),\r\n  id: z.string(),\r\n  question: z.string().default(\"\"),\r\n  questionHtml: z.string().optional(),\r\n  questionStyle: z.any().optional(),\r\n  options: z.array(QuizOptionSchema).default([]),\r\n  style: z.any().optional(),\r\n  optionStyle: z.any().optional(),\r\n});\r\n\r\nconst InteractiveBlockSchema = z.object({\r\n  type: z.literal(\"interactive\"),\r\n  id: z.string(),\r\n  variant: z.enum([\"button\", \"callout\", \"reveal\", \"custom\"]).default(\"button\"),\r\n  label: z.string().default(\"Interactive element\"),\r\n  url: z.string().optional(),\r\n  bodyHtml: z.string().optional(),\r\n  initiallyOpen: z.boolean().optional(),\r\n  tone: z.enum([\"info\", \"success\", \"warning\", \"danger\"]).optional(),\r\n  style: z.any().optional(),\r\n});\r\n\r\n// --------------------------\r\n\r\nexport const BlockSchema = z.discriminatedUnion(\"type\", [\r\n  TextBlockSchema,\r\n  ImageBlockSchema,\r\n  VideoBlockSchema,\r\n  QuizBlockSchema,\r\n  InteractiveBlockSchema,\r\n]);\r\n\r\n/**\r\n * --------------------------\r\n * Page Schema\r\n * --------------------------\r\n */\r\nexport const PageSchema = z.object({\r\n  id: z.string(),\r\n  title: z.string().default(\"Untitled Page\"),\r\n  blocks: z.array(BlockSchema).default([]),\r\n});\r\n\r\n/**\r\n * --------------------------\r\n * Project Schema\r\n * --------------------------\r\n */\r\nexport const ProjectSchema = z.object({\r\n  id: z.string().default(() => `proj-${Date.now()}`),\r\n  title: z.string().default(\"Untitled Lesson\"),\r\n  version: z.enum([\"1.2\", \"2004\"]).optional().default(\"1.2\"),\r\n\r\n  theme: z.object({\r\n    direction: z.enum([\"ltr\", \"rtl\"]).default(\"ltr\"),\r\n    styles: z.any().default({}),\r\n  }),\r\n\r\n  tracking: z.object({\r\n    level: z.enum([\"minimal\", \"standard\", \"advanced\"]).default(\"standard\"),\r\n    pageViews: z.boolean().default(true),\r\n    quizInteractions: z.boolean().default(true),\r\n    media: z.boolean().default(true),\r\n    hints: z.boolean().default(false),\r\n    externalLinks: z.boolean().default(false),\r\n    timePerPage: z.boolean().default(true),\r\n    attempts: z.boolean().default(true),\r\n  }),\r\n\r\n  xapi: z.object({\r\n    lrsEndpoint: z.string().default(\"\"),\r\n    authToken: z.string().default(\"\"),\r\n    activityIdFormat: z.string().default(\"iri\"),\r\n    statementExtensions: z.string().default(\"{}\"),\r\n  }),\r\n\r\n  pages: z.array(PageSchema).default([]),\r\n});\r\n\r\n/**\r\n * --------------------------\r\n * Lesson Result Schema\r\n * --------------------------\r\n */\r\nexport const BuildLessonResultSchema = z.object({\r\n  project: ProjectSchema,\r\n  warnings: z.array(z.string()).default([]),\r\n  metadata: z.object({\r\n    predictedDifficulty: z.enum([\"easy\", \"medium\", \"hard\"]).default(\"easy\"),\r\n    recommendedTags: z.array(z.string()).default([]),\r\n    routerSummary: z.string().default(\"\"),\r\n    routing: z.any(),\r\n  }),\r\n});\r\n\r\n/**\r\n * Auto-parse with fallback\r\n */\r\nexport function safeParseProject(json: any) {\r\n  const res = ProjectSchema.safeParse(json);\r\n  if (res.success) return res.data;\r\n\r\n  console.warn(\"⚠️ AI returned invalid JSON, applying fallback normalization.\");\r\n  console.warn(res.error.format());\r\n\r\n  // fallback to an empty-but-valid project\r\n  return ProjectSchema.parse({});\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 498, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/lib/ai/pipeline.ts"],"sourcesContent":["// lib/ai/pipeline.ts\r\n\r\nimport { mentorStage } from \"./agents/mentor\";\r\nimport { architectStage } from \"./agents/architect\";\r\nimport { deepResearchStage } from \"./agents/deepresearch\";\r\nimport { normalizeLesson } from \"./utils/normalize\";\r\nimport { sanitizeText } from \"./utils/sanitize\";\r\nimport { safeParseProject } from \"./ai-schema\";\r\n\r\n// Use Next.js built-in UUID generator\r\nconst uuid = () => crypto.randomUUID();\r\n\r\n/**\r\n * Full SCORM AI Pipeline:\r\n * Mentor → Architect → Deep Research → Normalize → SCORM JSON\r\n */\r\n\r\nexport async function runAIPipeline(messages: any[]) {\r\n  const cleanedMessages = messages.map((m: any) => ({\r\n    role: m.role,\r\n    content: sanitizeText(m.content),\r\n  }));\r\n\r\n  const mentorOut = await mentorStage(cleanedMessages);\r\n  const architectOut = await architectStage(mentorOut);\r\n  const enrichedOut = await deepResearchStage(architectOut);\r\n\r\n  const normalized = normalizeLesson(enrichedOut);\r\n\r\n  const projectJson = {\r\n    id: `proj-${uuid()}`,\r\n    title: normalized.title,\r\n    version: \"1.2\",\r\n    theme: {\r\n      direction: \"ltr\",\r\n      styles: {},\r\n    },\r\n    tracking: {\r\n      level: \"standard\",\r\n      pageViews: true,\r\n      quizInteractions: true,\r\n      media: true,\r\n      hints: false,\r\n      externalLinks: false,\r\n      timePerPage: true,\r\n      attempts: true,\r\n    },\r\n    xapi: {\r\n      lrsEndpoint: \"\",\r\n      authToken: \"\",\r\n      activityIdFormat: \"iri\",\r\n      statementExtensions: \"{}\",\r\n    },\r\n    pages: normalized.pages.map((p) => ({\r\n      id: `page-${uuid()}`,\r\n      title: p.title,\r\n      blocks: p.blocks.map((b) => ({\r\n        id: `block-${uuid()}`,\r\n        type: b.type,\r\n        html: b.type === \"text\" ? sanitizeText(b.content || \"\") : undefined,\r\n        src: b.type === \"image\" ? \"\" : undefined,\r\n        question: b.type === \"quiz\" ? (b.content || \"\") : undefined,\r\n        options: b.type === \"quiz\" ? [] : undefined,\r\n      })),\r\n    })),\r\n  };\r\n\r\n  const finalProject = safeParseProject(projectJson);\r\n\r\n  return {\r\n    agent: \"pipeline\",\r\n    content: \"Lesson generated successfully.\",\r\n    project: finalProject,\r\n    warnings: [],\r\n    metadata: {\r\n      predictedDifficulty: \"medium\",\r\n      recommendedTags: [],\r\n      routerSummary: \"\",\r\n      routing: {},\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;AAErB;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEA,sCAAsC;AACtC,MAAM,OAAO,IAAM,OAAO,UAAU;AAO7B,eAAe,cAAc,QAAe;IACjD,MAAM,kBAAkB,SAAS,GAAG,CAAC,CAAC,IAAW,CAAC;YAChD,MAAM,EAAE,IAAI;YACZ,SAAS,IAAA,gJAAY,EAAC,EAAE,OAAO;QACjC,CAAC;IAED,MAAM,YAAY,MAAM,IAAA,8IAAW,EAAC;IACpC,MAAM,eAAe,MAAM,IAAA,oJAAc,EAAC;IAC1C,MAAM,cAAc,MAAM,IAAA,0JAAiB,EAAC;IAE5C,MAAM,aAAa,IAAA,oJAAe,EAAC;IAEnC,MAAM,cAAc;QAClB,IAAI,CAAC,KAAK,EAAE,QAAQ;QACpB,OAAO,WAAW,KAAK;QACvB,SAAS;QACT,OAAO;YACL,WAAW;YACX,QAAQ,CAAC;QACX;QACA,UAAU;YACR,OAAO;YACP,WAAW;YACX,kBAAkB;YAClB,OAAO;YACP,OAAO;YACP,eAAe;YACf,aAAa;YACb,UAAU;QACZ;QACA,MAAM;YACJ,aAAa;YACb,WAAW;YACX,kBAAkB;YAClB,qBAAqB;QACvB;QACA,OAAO,WAAW,KAAK,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;gBAClC,IAAI,CAAC,KAAK,EAAE,QAAQ;gBACpB,OAAO,EAAE,KAAK;gBACd,QAAQ,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,IAAM,CAAC;wBAC3B,IAAI,CAAC,MAAM,EAAE,QAAQ;wBACrB,MAAM,EAAE,IAAI;wBACZ,MAAM,EAAE,IAAI,KAAK,SAAS,IAAA,gJAAY,EAAC,EAAE,OAAO,IAAI,MAAM;wBAC1D,KAAK,EAAE,IAAI,KAAK,UAAU,KAAK;wBAC/B,UAAU,EAAE,IAAI,KAAK,SAAU,EAAE,OAAO,IAAI,KAAM;wBAClD,SAAS,EAAE,IAAI,KAAK,SAAS,EAAE,GAAG;oBACpC,CAAC;YACH,CAAC;IACH;IAEA,MAAM,eAAe,IAAA,+IAAgB,EAAC;IAEtC,OAAO;QACL,OAAO;QACP,SAAS;QACT,SAAS;QACT,UAAU,EAAE;QACZ,UAAU;YACR,qBAAqB;YACrB,iBAAiB,EAAE;YACnB,eAAe;YACf,SAAS,CAAC;QACZ;IACF;AACF"}},
    {"offset": {"line": 581, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Windows%2011/Desktop/%D9%85%D8%B4%D8%B1%D9%88%D8%B9%20%D8%A7%D9%84%D8%AA%D8%AE%D8%B1%D8%AC/EduPack-new-interface/app/api/scorm/chat/route.ts"],"sourcesContent":["// app/api/scorm/chat/route.ts\r\n\r\nexport const dynamic = \"force-dynamic\";\r\nexport const revalidate = 0;\r\nexport const fetchCache = \"force-no-store\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { runAIPipeline } from \"@/lib/ai/pipeline\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const { messages } = body;\r\n\r\n    if (!messages || !Array.isArray(messages)) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid payload: messages[] is required.\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const result = await runAIPipeline(messages);\r\n\r\n    return NextResponse.json(result, { status: 200 });\r\n  } catch (error: any) {\r\n    console.error(\"❌ SCORM AI Chat Error:\", error);\r\n    return NextResponse.json(\r\n      { error: error?.message || \"AI processing failed\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,8BAA8B;;;;;;;;;;;;;AAO9B;AACA;AANO,MAAM,UAAU;AAChB,MAAM,aAAa;AACnB,MAAM,aAAa;AACnB,MAAM,UAAU;;;AAKhB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,QAAQ,EAAE,GAAG;QAErB,IAAI,CAAC,YAAY,CAAC,MAAM,OAAO,CAAC,WAAW;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,IAAA,wIAAa,EAAC;QAEnC,OAAO,gJAAY,CAAC,IAAI,CAAC,QAAQ;YAAE,QAAQ;QAAI;IACjD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,OAAO,WAAW;QAAuB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}