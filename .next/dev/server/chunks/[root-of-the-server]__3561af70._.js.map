{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/user/EduPack-new-interface/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient, type CookieOptions } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\nexport function createClient() {\n  const cookieStore = cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        get(name: string) {\n          return cookieStore.get(name)?.value\n        },\n        set(name: string, value: string, options: CookieOptions) {\n          try {\n            cookieStore.set({ name, value, ...options })\n          } catch (error) {\n            // The `cookies().set()` method can only be called in a Server Action or Route Handler\n            // If you're called from a Server Component, this would be a no-op.\n          }\n        },\n        remove(name: string, options: CookieOptions) {\n          try {\n            cookieStore.set({ name, value: '', ...options, maxAge: -1 })\n          } catch (error) {\n            // The `cookies().set()` method can only be called in a Server Action or Route Handler\n            // If you're called from a Server Component, this would be a no-op.\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,SAAS;IACd,MAAM,cAAc,IAAA,2QAAO;IAE3B,OAAO,IAAA,8SAAkB,sUAGvB;QACE,SAAS;YACP,KAAI,IAAY;gBACd,OAAO,YAAY,GAAG,CAAC,OAAO;YAChC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACrD,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC5C,EAAE,OAAO,OAAO;gBACd,sFAAsF;gBACtF,mEAAmE;gBACrE;YACF;YACA,QAAO,IAAY,EAAE,OAAsB;gBACzC,IAAI;oBACF,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;wBAAE,QAAQ,CAAC;oBAAE;gBAC5D,EAAE,OAAO,OAAO;gBACd,sFAAsF;gBACtF,mEAAmE;gBACrE;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///home/user/EduPack-new-interface/app/api/scorm/save/route.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/server';\nimport { NextResponse } from 'next/server';\n\nexport async function POST(request: Request) {\n  // 1. Get user and validate session\n  const supabase = createClient();\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  if (!user) {\n    return new NextResponse(JSON.stringify({ error: 'User not logged in.' }), { status: 401 });\n  }\n\n  // 2. Get and validate the project data from the request body\n  const project = await request.json();\n  if (!project || !project.id) {\n    return new NextResponse(JSON.stringify({ error: 'Invalid project data.' }), { status: 400 });\n  }\n\n  const filePath = `${user.id}/${project.id}/project.json`;\n\n  // 3. Upload the project JSON to Supabase Storage\n  try {\n    const { error: storageError } = await supabase.storage\n      .from('packages')\n      .upload(filePath, JSON.stringify(project), {\n        cacheControl: '3600',\n        upsert: true,\n      });\n\n    if (storageError) {\n      throw new Error(`Supabase Storage Error: ${storageError.message}`);\n    }\n  } catch (e: any) {\n    console.error('--- STORAGE UPLOAD FAILED ---', e.message);\n    return new NextResponse(\n      JSON.stringify({\n        error: '[STORAGE_UPLOAD_FAILED] Failed to save project content.',\n        details: e.message,\n      }),\n      { status: 500 }\n    );\n  }\n\n  // 4. Save the project metadata to the Supabase database\n  try {\n    const packageData = {\n      package_id: project.id,\n      title: project.title,\n      description: project.description || null,\n      is_listed_in_store: project.isListedInStore || false,\n      storage_path: filePath,\n      created_by_user_id: user.id,\n      updated_at: new Date().toISOString(),\n    };\n\n    const { error: dbError } = await supabase\n      .from('packages')\n      .upsert(packageData, { onConflict: 'package_id' });\n\n    if (dbError) {\n      throw new Error(`Supabase DB Error: ${dbError.message}`);\n    }\n\n    return NextResponse.json({ message: 'Project saved successfully' });\n  } catch (e: any) {\n    console.error('--- DATABASE WRITE FAILED (SUPABASE) ---', e.message);\n    return new NextResponse(\n      JSON.stringify({\n        error: '[DATABASE_WRITE_FAILED] Failed to save project metadata.',\n        details: e.message,\n      }),\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,mCAAmC;IACnC,MAAM,WAAW,IAAA,2IAAY;IAC7B,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,+QAAY,CAAC,KAAK,SAAS,CAAC;YAAE,OAAO;QAAsB,IAAI;YAAE,QAAQ;QAAI;IAC1F;IAEA,6DAA6D;IAC7D,MAAM,UAAU,MAAM,QAAQ,IAAI;IAClC,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,EAAE;QAC3B,OAAO,IAAI,+QAAY,CAAC,KAAK,SAAS,CAAC;YAAE,OAAO;QAAwB,IAAI;YAAE,QAAQ;QAAI;IAC5F;IAEA,MAAM,WAAW,GAAG,KAAK,EAAE,CAAC,CAAC,EAAE,QAAQ,EAAE,CAAC,aAAa,CAAC;IAExD,iDAAiD;IACjD,IAAI;QACF,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAAS,OAAO,CACnD,IAAI,CAAC,YACL,MAAM,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU;YACzC,cAAc;YACd,QAAQ;QACV;QAEF,IAAI,cAAc;YAChB,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,aAAa,OAAO,EAAE;QACnE;IACF,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,iCAAiC,EAAE,OAAO;QACxD,OAAO,IAAI,+QAAY,CACrB,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,EAAE,OAAO;QACpB,IACA;YAAE,QAAQ;QAAI;IAElB;IAEA,wDAAwD;IACxD,IAAI;QACF,MAAM,cAAc;YAClB,YAAY,QAAQ,EAAE;YACtB,OAAO,QAAQ,KAAK;YACpB,aAAa,QAAQ,WAAW,IAAI;YACpC,oBAAoB,QAAQ,eAAe,IAAI;YAC/C,cAAc;YACd,oBAAoB,KAAK,EAAE;YAC3B,YAAY,IAAI,OAAO,WAAW;QACpC;QAEA,MAAM,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,SAC9B,IAAI,CAAC,YACL,MAAM,CAAC,aAAa;YAAE,YAAY;QAAa;QAElD,IAAI,SAAS;YACX,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,QAAQ,OAAO,EAAE;QACzD;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAA6B;IACnE,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,4CAA4C,EAAE,OAAO;QACnE,OAAO,IAAI,+QAAY,CACrB,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,EAAE,OAAO;QACpB,IACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}