module.exports=[26860,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),i=e.i(14444),s=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),h=e.i(66012),g=e.i(70101),m=e.i(26937),f=e.i(10372),v=e.i(93695);e.i(52474);var b=e.i(220),y=e.i(89171);let R=process.env.LLM_API_ENDPOINT||"https://api.example.com/v1/chat/completions",w=process.env.LLM_API_KEY;async function E(e,t){if(!w){let r,a;return console.warn("LLM API key is not configured. Using fallback lesson generator."),r=e.trim()||"your topic",a=Date.now(),{title:`${"ar"===t?"درس عن":"Lesson on"} ${r}`,theme:{direction:"ar"===t?"rtl":"ltr",styles:{}},pages:[{id:`page-intro-${a}`,title:"ar"===t?"مقدمة":"Introduction",blocks:[{id:`block-intro-${a}`,type:"text",html:`<p>${"ar"===t?"نظرة عامة سريعة على":"A quick overview of"} ${r}.</p>`}]},{id:`page-practice-${a}`,title:"ar"===t?"تطبيق":"Practice",blocks:[{id:`block-practice-${a}`,type:"quiz",question:"ar"===t?"ما هو أهم مفهوم؟":"What is the key idea?",options:[{id:`opt-a-${a}`,label:"ar"===t?"المفهوم الصحيح":"The correct concept",correct:!0},{id:`opt-b-${a}`,label:"ar"===t?"تفصيل جانبي":"A side detail",correct:!1}]}]}]}}let r=`You are an expert instructional designer. Create a complete lesson package in ${"ar"===t?"Arabic":"English"} based on the user's request. The output MUST be a valid JSON object matching the structure of an EditorProject: { "title": "...", "pages": [{ "id": "...", "title": "...", "blocks": [...] }] }. The blocks can be of type 'text', 'image', 'video', or 'quiz'. For image blocks, provide a descriptive 'alt' text that can be used to generate an image later.`;try{let t=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify({model:"gpt-4-turbo",messages:[{role:"system",content:r},{role:"user",content:e}],response_format:{type:"json_object"}})});if(!t.ok){let e=await t.text();throw console.error("LLM API request failed:",t.status,e),Error(`The AI service failed to generate the lesson. Status: ${t.status}`)}let a=(await t.json()).choices[0].message.content;return JSON.parse(a)}catch(e){throw console.error("Error in generateLessonFromPrompt:",e),e}}async function x(e){var t;let r=e.pages.length,a=e.pages.reduce((e,t)=>e+t.blocks.length,0),n=e.pages.reduce((e,t)=>e+t.blocks.filter(e=>"quiz"===e.type).length,0),o=0===(t=e.pages).length?0:Math.round(t.reduce((e,t)=>e+t.blocks.filter(e=>"text"===e.type).map(e=>{let t;return(t=e.html.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim())?t.split(/\s+/).length:0}).reduce((e,t)=>e+t,0),0)/t.length);return r<=1&&o<120&&0===n?"easy":o+40*n+5*a+25*r<400?"medium":"hard"}async function A(e){let t=e.pages.map(e=>e.blocks.map(e=>"html"in e?e.html:"").join(" ")).join(" ").toLowerCase(),r=new Set;(t.includes("math")||t.includes("fraction")||t.includes("algebra"))&&r.add("Math"),(t.includes("reading")||t.includes("story")||t.includes("essay"))&&r.add("Literacy"),(t.includes("ecosystem")||t.includes("habitat")||t.includes("climate"))&&r.add("Science"),(t.includes("history")||t.includes("civilization")||t.includes("ancient"))&&r.add("Social Studies");let a=e.pages.some(e=>e.blocks.some(e=>"image"===e.type||"video"===e.type)),n=e.pages.some(e=>e.blocks.some(e=>"interactive"===e.type)),o=e.pages.some(e=>e.blocks.some(e=>"quiz"===e.type));return a&&r.add("Multimedia"),n&&r.add("Interactive"),o&&r.add("Assessment"),0===r.size&&r.add("General"),Array.from(r)}let k={level:"standard",pageViews:!0,quizInteractions:!0,media:!0,hints:!1,externalLinks:!1,timePerPage:!0,attempts:!0},C={lrsEndpoint:"",authToken:"",activityIdFormat:"iri",statementExtensions:"{}"};async function $(e,t){var r;let a,n,o;console.log(`Orchestrator: Starting lesson build for prompt: "${e}"`);let i=(a=e.toLowerCase(),n=/[\u0600-\u06FF]/.test(e),{language:n?"ar":"en",intent:"build_scorm_lesson",audience:a.includes("beginner")?"beginner":a.includes("advanced")?"advanced":"general",route:["level2","level1","level0"],notes:n?"Detected Arabic characters; routing with RTL defaults.":"Defaulted to English content and layouts."}),s=t||i.language;console.log("Orchestrator: Router analysis complete.",i);let l=(r=await E(e,s),{id:r.id||`proj-${Date.now()}`,title:r.title||"Untitled Project",version:"1.0",theme:r.theme||{direction:"ar"===s?"rtl":"ltr",styles:{}},pages:r.pages||[],tracking:r.tracking||{...k},xapi:r.xapi||{...C}});console.log("Orchestrator: Lesson content generated by Level 2 AI.",l);let[c,d]=await Promise.all([x(l),A(l)]);console.log(`Orchestrator: Level 1 ML predictions - Difficulty: ${c}, Tags: ${d.join(", ")}`);let u=(o=[],(!l.title||l.title.trim().length<3)&&o.push("Add a clear project title so learners understand the lesson focus."),0===l.pages.length&&o.push("Insert at least one page before exporting to SCORM."),l.pages.forEach((e,t)=>{let r=e.title?.trim().length?e.title:`Page ${t+1}`;(!e.title||e.title.trim().length<3)&&o.push(`${r}: use a descriptive title (3+ characters).`),e.blocks.length>20&&o.push(`${r}: consider splitting into smaller pages (over 20 blocks).`);let a=e.blocks.filter(e=>"text"===e.type),n=e.blocks.filter(e=>"quiz"===e.type),i=e.blocks.filter(e=>"image"===e.type);a.some(e=>!(e.html.replace(/<[^>]*>/g,"").trim().length>=40))&&o.push(`${r}: expand short text blocks to give learners context.`),n.forEach((e,t)=>{e.question?.trim()||o.push(`${r}: quiz ${t+1} is missing a question prompt.`),e.options.some(e=>!0===e.correct)||o.push(`${r}: mark at least one correct option in quiz ${t+1}.`)}),i.forEach((e,t)=>{e.alt&&e.alt.trim().length>=8||o.push(`${r}: provide a meaningful alt text for image ${t+1}.`)})}),o);console.log("Orchestrator: Validation complete. Warnings found:",u);let p=`Routed to ${i.route.join(" -> ")} for ${i.intent} in ${s.toUpperCase()} (${i.audience}). ${i.notes||""}`.trim();return console.log("Orchestrator: Build complete."),{project:l,warnings:u,metadata:{predictedDifficulty:c,recommendedTags:d,routerSummary:p,routing:i}}}async function P(e){try{let{prompt:t,language:r}=await e.json();if(!t)return y.NextResponse.json({error:"Prompt is required"},{status:400});if(r&&!["en","ar"].includes(r))return y.NextResponse.json({error:"Invalid language. Must be 'en' or 'ar'."},{status:400});let a=await $(t,r||"en");return y.NextResponse.json(a)}catch(e){return console.error("[API /ai/lesson/build] Error:",e),y.NextResponse.json({error:"An unexpected error occurred while building the lesson."},{status:500})}}e.s(["POST",()=>P],41872);var T=e.i(41872);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/ai/lesson/build/route",pathname:"/api/ai/lesson/build",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/ai/lesson/build/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:q}=O;function I(){return(0,a.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function _(e,t,a){O.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/ai/lesson/build/route";y=y.replace(/\/index$/,"")||"/";let R=await O.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:E,nextConfig:x,parsedUrl:A,isDraftMode:k,prerenderManifest:C,routerServerContext:$,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:S,clientReferenceManifest:N,serverActionsManifest:q}=R,I=(0,l.normalizeAppPath)(y),_=!!(C.dynamicRoutes[I]||C.routes[S]),M=async()=>((null==$?void 0:$.render404)?await $.render404(e,t,A,!1):t.end("This page could not be found"),null);if(_&&!k){let e=!!C.routes[S],t=C.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await M();throw new v.NoFallbackError}}let j=null;!_||O.isDev||k||(j="/index"===(j=S)?"/":j);let L=!0===O.isDev||!_,U=_&&!L;q&&N&&(0,i.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:N,serverActionsManifest:q,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:q})});let D=e.method||"GET",H=(0,o.getTracer)(),F=H.getActiveScopeSpan(),z={params:E,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>O.onRequestError(e,t,a,$)},sharedContext:{buildId:w}},K=new c.NodeNextRequest(e),B=new c.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let i=async e=>O.handle(V,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${D} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${y}`)}),s=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&P&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(n);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=z.renderOpts.collectedTags;if(!_)return await (0,h.sendResponse)(K,B,o,z.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,a=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},$),t}},d=await O.handleResponse({req:e,nextConfig:x,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!_)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&_||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(K,B,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};F?await l(F):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${D} ${y}`,kind:o.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})}),_)throw t;return await (0,h.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>I,"routeModule",()=>O,"serverHooks",()=>q,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N],26860)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_cf01ff5b.js.map