module.exports=[67065,e=>{"use strict";let t,s,r,n,a;function i(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function o(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}let l=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return l=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function c(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let d=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class u extends Error{}class h extends u{constructor(e,t,s,r){super(`${h.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){if(!e||!r)return new f({message:s,cause:d(t)});let n=t?.error;return 400===e?new g(e,n,s,r):401===e?new y(e,n,s,r):403===e?new _(e,n,s,r):404===e?new v(e,n,s,r):409===e?new b(e,n,s,r):422===e?new w(e,n,s,r):429===e?new x(e,n,s,r):e>=500?new k(e,n,s,r):new h(e,n,s,r)}}class p extends h{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class f extends h{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class m extends f{constructor({message:e}={}){super({message:e??"Request timed out."})}}class g extends h{}class y extends h{}class _ extends h{}class v extends h{}class b extends h{}class w extends h{}class x extends h{}class k extends h{}class S extends u{constructor(){super("Could not parse response content as the length limit was reached")}}class O extends u{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class A extends Error{constructor(e){super(e)}}let $=/^[a-z][a-z0-9+.-]*:/i,I=e=>(I=Array.isArray)(e),T=I;function R(e){return"object"!=typeof e?{}:e??{}}function E(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let C=e=>new Promise(t=>setTimeout(t,e)),P="6.9.1",j=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",N=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function Z(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function M(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Z({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function L(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function D(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let B=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),F="RFC3986",U=e=>String(e),W={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:U},q=(e,t)=>(q=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),z=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function K(e,t){if(I(e)){let s=[];for(let r=0;r<e.length;r+=1)s.push(t(e[r]));return s}return t(e)}let V={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},J=function(e,t){Array.prototype.push.apply(e,I(t)?t:[t])},H={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,r,n)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===s)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,s=[];for(let e=0;e<t.length;++e){let r=t.charCodeAt(e);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===n&&(40===r||41===r)){s[s.length]=t.charAt(e);continue}if(r<128){s[s.length]=z[r];continue}if(r<2048){s[s.length]=z[192|r>>6]+z[128|63&r];continue}if(r<55296||r>=57344){s[s.length]=z[224|r>>12]+z[128|r>>6&63]+z[128|63&r];continue}e+=1,r=65536+((1023&r)<<10|1023&t.charCodeAt(e)),s[s.length]=z[240|r>>18]+z[128|r>>12&63]+z[128|r>>6&63]+z[128|63&r]}i+=s.join("")}return i},encodeValuesOnly:!1,format:F,formatter:U,indices:!1,serializeDate:e=>(s??(s=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},X={};function Y(e){let t;return(r??(r=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function G(e){let t;return(n??(n=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class Q{constructor(){ne.set(this,void 0),nt.set(this,void 0),i(this,ne,new Uint8Array,"f"),i(this,nt,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?Y(e):e;i(this,ne,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([o(this,ne,"f"),s]),"f");let r=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(o(this,ne,"f"),o(this,nt,"f")));){if(t.carriage&&null==o(this,nt,"f")){i(this,nt,t.index,"f");continue}if(null!=o(this,nt,"f")&&(t.index!==o(this,nt,"f")+1||t.carriage)){r.push(G(o(this,ne,"f").subarray(0,o(this,nt,"f")-1))),i(this,ne,o(this,ne,"f").subarray(o(this,nt,"f")),"f"),i(this,nt,null,"f");continue}let e=null!==o(this,nt,"f")?t.preceding-1:t.preceding,s=G(o(this,ne,"f").subarray(0,e));r.push(s),i(this,ne,o(this,ne,"f").subarray(t.index),"f"),i(this,nt,null,"f")}return r}flush(){return o(this,ne,"f").length?this.decode("\n"):[]}}ne=new WeakMap,nt=new WeakMap,Q.NEWLINE_CHARS=new Set(["\n","\r"]),Q.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let ee={off:0,error:200,warn:300,info:400,debug:500},et=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(ee,e))return e;ei(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ee))}`)}};function es(){}function er(e,t,s){return!t||ee[e]>ee[s]?es:t[e].bind(t)}let en={error:es,warn:es,info:es,debug:es},ea=new WeakMap;function ei(e){let t=e.logger,s=e.logLevel??"off";if(!t)return en;let r=ea.get(t);if(r&&r[0]===s)return r[1];let n={error:er("error",t,s),warn:er("warn",t,s),info:er("info",t,s),debug:er("debug",t,s)};return ea.set(t,[s,n]),n}let eo=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class el{constructor(e,t,s){this.iterator=e,ns.set(this,void 0),this.controller=t,i(this,ns,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?ei(s):console;async function*a(){if(r)throw new u("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let r of ec(e,t))if(!s){if(r.data.startsWith("[DONE]")){s=!0;continue}if(null!==r.event&&r.event.startsWith("thread.")){let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new h(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}else{let t;try{t=JSON.parse(r.data)}catch(e){throw n.error("Could not parse message into JSON:",r.data),n.error("From chunk:",r.raw),e}if(t&&t.error)throw new h(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(c(e))return;throw e}finally{s||t.abort()}}return new el(a,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new Q;for await(let s of L(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new el(async function*(){if(r)throw new u("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(c(e))return;throw e}finally{e||t.abort()}},t,s)}[(ns=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new el(()=>r(e),this.controller,o(this,ns,"f")),new el(()=>r(t),this.controller,o(this,ns,"f"))]}toReadableStream(){let e,t=this;return Z({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=Y(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*ec(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new u("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new u("Attempted to iterate over a response with no body")}let s=new eu,r=new Q;for await(let t of ed(L(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*ed(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?Y(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class eu{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,a]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===r?this.event=a:"data"===r&&this.data.push(a),null}}async function eh(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(ei(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):el.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?ep(await s.json(),s):await s.text()})();return ei(e).debug(`[${r}] response parsed`,eo({retryOfRequestLogID:n,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function ep(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ef extends Promise{constructor(e,t,s=eh){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,nr.set(this,void 0),i(this,nr,e,"f")}_thenUnwrap(e){return new ef(o(this,nr,"f"),this.responsePromise,async(t,s)=>ep(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(o(this,nr,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}nr=new WeakMap;class em{constructor(e,t,s,r){nn.set(this,void 0),i(this,nn,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new u("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await o(this,nn,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(nn=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class eg extends ef{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await eh(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class ey extends em{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class e_ extends em{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...R(this.options.query),after:t}}:null}}class ev extends em{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...R(this.options.query),after:e}}:null}}let eb=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ew(e,t,s){return eb(),new File(e,t??"unknown_file",s)}function ex(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let ek=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],eS=async(e,t)=>eT(e.body)?{...e,body:await e$(e.body,t)}:e,eO=async(e,t)=>({...e,body:await e$(e.body,t)}),eA=new WeakMap,e$=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=eA.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return eA.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>eR(s,e,t))),s},eI=e=>e instanceof Blob&&"name"in e,eT=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||ek(e)||eI(e)))return!0;if(Array.isArray(e))return e.some(eT);if(e&&"object"==typeof e){for(let t in e)if(eT(e[t]))return!0}return!1},eR=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,ew([await s.blob()],ex(s)));else if(ek(s))e.append(t,ew([await new Response(M(s)).blob()],ex(s)));else if(eI(s))e.append(t,s,ex(s));else if(Array.isArray(s))await Promise.all(s.map(s=>eR(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>eR(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},eE=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function eC(e,t,s){let r,n;if(eb(),null!=(r=e=await e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&eE(r))return e instanceof File?e:ew([await e.arrayBuffer()],e.name);if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ew(await eP(r),t,s)}let a=await eP(e);if(t||(t=ex(e)),!s?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return ew(a,t,s)}async function eP(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(eE(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(ek(e))for await(let s of e)t.push(...await eP(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class ej{constructor(e){this._client=e}}function eN(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let eZ=Object.freeze(Object.create(null)),eM=((e=eN)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,a=[],i=t.reduce((t,r,i)=>{/[?#]/.test(r)&&(n=!0);let o=s[i],l=(n?encodeURIComponent:e)(""+o);return i!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??eZ)??eZ)?.toString)&&(l=o+"",a.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(i===s.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)a.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new u(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(eN);class eL extends ej{list(e,t={},s){return this._client.getAPIList(eM`/chat/completions/${e}/messages`,e_,{query:t,...s})}}function eD(e){return void 0!==e&&"function"in e&&void 0!==e.function}function eB(e){return e?.$brand==="auto-parseable-response-format"}function eF(e){return e?.$brand==="auto-parseable-tool"}function eU(e,t){let s=e.choices.map(e=>{var s,r;if("length"===e.finish_reason)throw new S;if("content_filter"===e.finish_reason)throw new O;return eq(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var s,r;let n;return s=t,r=e,n=s.tools?.find(e=>eD(e)&&e.function?.name===r.function.name),{...r,function:{...r.function,parsed_arguments:eF(n)?n.$parseRaw(r.function.arguments):n?.function.strict?JSON.parse(r.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,r=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:s}}function eW(e){return!!eB(e.response_format)||(e.tools?.some(e=>eF(e)||"function"===e.type&&!0===e.function.strict)??!1)}function eq(e){for(let t of e||[])if("function"!==t.type)throw new u(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let ez=e=>e?.role==="assistant",eK=e=>e?.role==="tool";class eV{constructor(){na.add(this),this.controller=new AbortController,ni.set(this,void 0),no.set(this,()=>{}),nl.set(this,()=>{}),nc.set(this,void 0),nd.set(this,()=>{}),nu.set(this,()=>{}),nh.set(this,{}),np.set(this,!1),nf.set(this,!1),nm.set(this,!1),ng.set(this,!1),i(this,ni,new Promise((e,t)=>{i(this,no,e,"f"),i(this,nl,t,"f")}),"f"),i(this,nc,new Promise((e,t)=>{i(this,nd,e,"f"),i(this,nu,t,"f")}),"f"),o(this,ni,"f").catch(()=>{}),o(this,nc,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},o(this,na,"m",ny).bind(this))},0)}_connected(){this.ended||(o(this,no,"f").call(this),this._emit("connect"))}get ended(){return o(this,np,"f")}get errored(){return o(this,nf,"f")}get aborted(){return o(this,nm,"f")}abort(){this.controller.abort()}on(e,t){return(o(this,nh,"f")[e]||(o(this,nh,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=o(this,nh,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(o(this,nh,"f")[e]||(o(this,nh,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{i(this,ng,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){i(this,ng,!0,"f"),await o(this,nc,"f")}_emit(e,...t){if(o(this,np,"f"))return;"end"===e&&(i(this,np,!0,"f"),o(this,nd,"f").call(this));let s=o(this,nh,"f")[e];if(s&&(o(this,nh,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];o(this,ng,"f")||s?.length||Promise.reject(e),o(this,nl,"f").call(this,e),o(this,nu,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];o(this,ng,"f")||s?.length||Promise.reject(e),o(this,nl,"f").call(this,e),o(this,nu,"f").call(this,e),this._emit("end")}}_emitFinal(){}}ni=new WeakMap,no=new WeakMap,nl=new WeakMap,nc=new WeakMap,nd=new WeakMap,nu=new WeakMap,nh=new WeakMap,np=new WeakMap,nf=new WeakMap,nm=new WeakMap,ng=new WeakMap,na=new WeakSet,ny=function(e){if(i(this,nf,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new p),e instanceof p)return i(this,nm,!0,"f"),this._emit("abort",e);if(e instanceof u)return this._emit("error",e);if(e instanceof Error){let t=new u(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new u(String(e)))};class eJ extends eV{constructor(){super(...arguments),n_.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),eK(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ez(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new u("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),o(this,n_,"m",nv).call(this)}async finalMessage(){return await this.done(),o(this,n_,"m",nb).call(this)}async finalFunctionToolCall(){return await this.done(),o(this,n_,"m",nw).call(this)}async finalFunctionToolCallResult(){return await this.done(),o(this,n_,"m",nx).call(this)}async totalUsage(){return await this.done(),o(this,n_,"m",nk).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=o(this,n_,"m",nb).call(this);t&&this._emit("finalMessage",t);let s=o(this,n_,"m",nv).call(this);s&&this._emit("finalContent",s);let r=o(this,n_,"m",nw).call(this);r&&this._emit("finalFunctionToolCall",r);let n=o(this,n_,"m",nx).call(this);null!=n&&this._emit("finalFunctionToolCallResult",n),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",o(this,n_,"m",nk).call(this))}async _createChatCompletion(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,n_,"m",nS).call(this,t);let n=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(eU(n,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let r="tool",{tool_choice:n="auto",stream:a,...i}=t,l="string"!=typeof n&&"function"===n.type&&n?.function?.name,{maxChatCompletions:c=10}=s||{},d=t.tools.map(e=>{if(eF(e)){if(!e.$callback)throw new u("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of d)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let p="tools"in t?d.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:n,tools:p,messages:[...this.messages]},s),a=t.choices[0]?.message;if(!a)throw new u("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:n,arguments:a}=e.function,i=h[n];if(i){if(l&&l!==n){let e=`Invalid tool_call: ${JSON.stringify(n)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(n)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:s,content:e});continue}try{t="function"==typeof i.parse?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:r,tool_call_id:s,content:e});continue}let c=await i.function(t,this),d=o(this,n_,"m",nO).call(this,c);if(this._addMessage({role:r,tool_call_id:s,content:d}),l)return}}}}n_=new WeakSet,nv=function(){return o(this,n_,"m",nb).call(this).content??null},nb=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ez(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new u("stream ended without producing a ChatCompletionMessage with role=assistant")},nw=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ez(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},nx=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(eK(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},nk=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},nS=function(e){if(null!=e.n&&e.n>1)throw new u("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},nO=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class eH extends eJ{static runTools(e,t,s){let r=new eH,n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}_addMessage(e,t=!0){super._addMessage(e,t),ez(e)&&e.content&&this._emit("content",e.content)}}let eX=511;class eY extends Error{}class eG extends Error{}let eQ=e=>(function(e,t=eX){var s,r;let n,a,i,o,l,c,d,u,h,p;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return s=e.trim(),r=t,n=s.length,a=0,i=e=>{throw new eY(`${e} at position ${a}`)},o=e=>{throw new eG(`${e} at position ${a}`)},l=()=>(p(),a>=n&&i("Unexpected end of input"),'"'===s[a])?c():"{"===s[a]?d():"["===s[a]?u():"null"===s.substring(a,a+4)||16&r&&n-a<4&&"null".startsWith(s.substring(a))?(a+=4,null):"true"===s.substring(a,a+4)||32&r&&n-a<4&&"true".startsWith(s.substring(a))?(a+=4,!0):"false"===s.substring(a,a+5)||32&r&&n-a<5&&"false".startsWith(s.substring(a))?(a+=5,!1):"Infinity"===s.substring(a,a+8)||128&r&&n-a<8&&"Infinity".startsWith(s.substring(a))?(a+=8,1/0):"-Infinity"===s.substring(a,a+9)||256&r&&1<n-a&&n-a<9&&"-Infinity".startsWith(s.substring(a))?(a+=9,-1/0):"NaN"===s.substring(a,a+3)||64&r&&n-a<3&&"NaN".startsWith(s.substring(a))?(a+=3,NaN):h(),c=()=>{let e=a,t=!1;for(a++;a<n&&('"'!==s[a]||t&&"\\"===s[a-1]);)t="\\"===s[a]&&!t,a++;if('"'==s.charAt(a))try{return JSON.parse(s.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&r)try{return JSON.parse(s.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(s.substring(e,s.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},d=()=>{a++,p();let e={};try{for(;"}"!==s[a];){if(p(),a>=n&&8&r)return e;let t=c();p(),a++;try{let s=l();Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&r)return e;throw t}p(),","===s[a]&&a++}}catch(t){if(8&r)return e;i("Expected '}' at end of object")}return a++,e},u=()=>{a++;let e=[];try{for(;"]"!==s[a];)e.push(l()),p(),","===s[a]&&a++}catch(t){if(4&r)return e;i("Expected ']' at end of array")}return a++,e},h=()=>{if(0===a){"-"===s&&2&r&&i("Not sure what '-' is");try{return JSON.parse(s)}catch(e){if(2&r)try{if("."===s[s.length-1])return JSON.parse(s.substring(0,s.lastIndexOf(".")));return JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===s[a]&&a++;s[a]&&!",]}".includes(s[a]);)a++;a!=n||2&r||i("Unterminated number literal");try{return JSON.parse(s.substring(e,a))}catch(t){"-"===s.substring(e,a)&&2&r&&i("Not sure what '-' is");try{return JSON.parse(s.substring(e,s.lastIndexOf("e")))}catch(e){o(String(e))}}},p=()=>{for(;a<n&&" \n\r	".includes(s[a]);)a++},l()})(e,2^eX);class e0 extends eJ{constructor(e){super(),nA.add(this),n$.set(this,void 0),nI.set(this,void 0),nT.set(this,void 0),i(this,n$,e,"f"),i(this,nI,[],"f")}get currentChatCompletionSnapshot(){return o(this,nT,"f")}static fromReadableStream(e){let t=new e0(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let r=new e0(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,s){super._createChatCompletion;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,nA,"m",nR).call(this);let n=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),n))o(this,nA,"m",nC).call(this,e);if(n.controller.signal?.aborted)throw new p;return this._addChatCompletion(o(this,nA,"m",nN).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),o(this,nA,"m",nR).call(this),this._connected();let n=el.fromReadableStream(e,this.controller);for await(let e of n)s&&s!==e.id&&this._addChatCompletion(o(this,nA,"m",nN).call(this)),o(this,nA,"m",nC).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new p;return this._addChatCompletion(o(this,nA,"m",nN).call(this))}[(n$=new WeakMap,nI=new WeakMap,nT=new WeakMap,nA=new WeakSet,nR=function(){this.ended||i(this,nT,void 0,"f")},nE=function(e){let t=o(this,nI,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},o(this,nI,"f")[e.index]=t),t},nC=function(e){if(this.ended)return;let t=o(this,nA,"m",nM).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let r=o(this,nA,"m",nE).call(this,e);for(let t of(e.finish_reason&&(o(this,nA,"m",nj).call(this,e),null!=r.current_tool_call_index&&o(this,nA,"m",nP).call(this,e,r.current_tool_call_index)),s.delta.tool_calls??[]))r.current_tool_call_index!==t.index&&(o(this,nA,"m",nj).call(this,e),null!=r.current_tool_call_index&&o(this,nA,"m",nP).call(this,e,r.current_tool_call_index)),r.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):e4(s?.type))}}},nP=function(e,t){if(o(this,nA,"m",nE).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=o(this,n$,"f")?.tools?.find(e=>eD(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:eF(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else e4(s.type)},nj=function(e){let t=o(this,nA,"m",nE).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=o(this,nA,"m",nZ).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},nN=function(){if(this.ended)throw new u("stream has ended, this shouldn't happen");let e=o(this,nT,"f");if(!e)throw new u("request ended without sending any chunks");return i(this,nT,void 0,"f"),i(this,nI,[],"f"),function(e,t){var s;let{id:r,choices:n,created:a,model:i,system_fingerprint:o,...l}=e;return s={...l,id:r,choices:n.map(({message:t,finish_reason:s,index:r,logprobs:n,...a})=>{if(!s)throw new u(`missing finish_reason for choice ${r}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,d=t.role;if(!d)throw new u(`missing role for choice ${r}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new u(`missing function_call.arguments for choice ${r}`);if(!l)throw new u(`missing function_call.name for choice ${r}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:d,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}return l?{...a,index:r,finish_reason:s,logprobs:n,message:{...c,role:d,content:i,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:n,type:a,id:i,...o}=t,{arguments:l,name:c,...d}=n||{};if(null==i)throw new u(`missing choices[${r}].tool_calls[${s}].id
${e1(e)}`);if(null==a)throw new u(`missing choices[${r}].tool_calls[${s}].type
${e1(e)}`);if(null==c)throw new u(`missing choices[${r}].tool_calls[${s}].function.name
${e1(e)}`);if(null==l)throw new u(`missing choices[${r}].tool_calls[${s}].function.arguments
${e1(e)}`);return{...o,id:i,type:a,function:{...d,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:d,refusal:t.refusal??null},finish_reason:s,index:r,logprobs:n}}),created:a,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&eW(t)?eU(s,t):{...s,choices:s.choices.map(e=>(eq(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,o(this,n$,"f"))},nZ=function(){let e=o(this,n$,"f")?.response_format;return eB(e)?e:null},nM=function(e){var t,s,r,n;let a=o(this,nT,"f"),{choices:l,...c}=e;for(let{delta:l,finish_reason:d,index:u,logprobs:h=null,...p}of(a?Object.assign(a,c):a=i(this,nT,{...c,choices:[]},"f"),e.choices)){let e=a.choices[u];if(e||(e=a.choices[u]={finish_reason:d,index:u,message:{},logprobs:h,...p}),h)if(e.logprobs){let{content:r,refusal:n,...a}=h;e2(a),Object.assign(e.logprobs,a),r&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...r)),n&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...n))}else e.logprobs=Object.assign({},h);if(d&&(e.finish_reason=d,o(this,n$,"f")&&eW(o(this,n$,"f")))){if("length"===d)throw new S;if("content_filter"===d)throw new O}if(Object.assign(e,p),!l)continue;let{content:i,refusal:c,function_call:f,role:m,tool_calls:g,...y}=l;if(e2(y),Object.assign(e.message,y),c&&(e.message.refusal=(e.message.refusal||"")+c),m&&(e.message.role=m),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((r=e.message.function_call).arguments??(r.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),i&&(e.message.content=(e.message.content||"")+i,!e.message.refusal&&o(this,nA,"m",nZ).call(this)&&(e.message.parsed=eQ(e.message.content))),g)for(let{index:t,id:s,type:r,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),g)){let l=(n=e.message.tool_calls)[t]??(n[t]={});Object.assign(l,i),s&&(l.id=s),r&&(l.type=r),a&&(l.function??(l.function={name:a.name??"",arguments:""})),a?.name&&(l.function.name=a.name),a?.arguments&&(l.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>eD(e)&&e.function?.name===t.function.name);return eD(s)&&(eF(s)||s?.function.strict||!1)}(o(this,n$,"f"),l)&&(l.function.parsed_arguments=eQ(l.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new el(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function e1(e){return JSON.stringify(e)}function e2(e){}function e4(e){}class e9 extends e0{static fromReadableStream(e){let t=new e9(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let r=new e9(t),n={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,n)),r}}class e3 extends ej{constructor(){super(...arguments),this.messages=new eL(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(eM`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(eM`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",e_,{query:e,...t})}delete(e,t){return this._client.delete(eM`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new u(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new u(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>eU(t,e))}runTools(e,t){return e.stream?e9.runTools(this._client,e,t):eH.runTools(this._client,e,t)}stream(e,t){return e0.createChatCompletion(this._client,e,t)}}e3.Messages=eL;class e5 extends ej{constructor(){super(...arguments),this.completions=new e3(this._client)}}e5.Completions=e3,e.s([],98546);let e6=Symbol("brand.privateNullableHeaders"),e8=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,a]of function*(e){let t;if(!e)return;if(e6 in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():T(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=T(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===a?(t.delete(n),s.add(r)):(t.append(n,a),s.delete(r))}}return{[e6]:!0,values:t,nulls:s}};class e7 extends ej{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:e8([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class te extends ej{create(e,t){return this._client.post("/audio/transcriptions",eO({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class tt extends ej{create(e,t){return this._client.post("/audio/translations",eO({body:e,...t,__metadata:{model:e.model}},this._client))}}class ts extends ej{constructor(){super(...arguments),this.transcriptions=new te(this._client),this.translations=new tt(this._client),this.speech=new e7(this._client)}}ts.Transcriptions=te,ts.Translations=tt,ts.Speech=e7;class tr extends ej{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(eM`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",e_,{query:e,...t})}cancel(e,t){return this._client.post(eM`/batches/${e}/cancel`,t)}}class tn extends ej{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eM`/assistants/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(eM`/assistants/${e}`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",e_,{query:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(eM`/assistants/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ta extends ej{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class ti extends ej{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class to extends ej{constructor(){super(...arguments),this.sessions=new ta(this._client),this.transcriptionSessions=new ti(this._client)}}to.Sessions=ta,to.TranscriptionSessions=ti;class tl extends ej{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(eM`/chatkit/sessions/${e}/cancel`,{...t,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class tc extends ej{retrieve(e,t){return this._client.get(eM`/chatkit/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",ev,{query:e,...t,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(eM`/chatkit/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(eM`/chatkit/threads/${e}/items`,ev,{query:t,...s,headers:e8([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class td extends ej{constructor(){super(...arguments),this.sessions=new tl(this._client),this.threads=new tc(this._client)}}td.Sessions=tl,td.Threads=tc;class tu extends ej{create(e,t,s){return this._client.post(eM`/threads/${e}/messages`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(eM`/threads/${r}/messages/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(eM`/threads/${r}/messages/${e}`,{body:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(eM`/threads/${e}/messages`,e_,{query:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:r}=t;return this._client.delete(eM`/threads/${r}/messages/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class th extends ej{retrieve(e,t,s){let{thread_id:r,run_id:n,...a}=t;return this._client.get(eM`/threads/${r}/runs/${n}/steps/${e}`,{query:a,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:r,...n}=t;return this._client.getAPIList(eM`/threads/${r}/runs/${e}/steps`,e_,{query:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let tp=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class tf extends eV{constructor(){super(...arguments),nL.add(this),nB.set(this,[]),nF.set(this,{}),nU.set(this,{}),nW.set(this,void 0),nq.set(this,void 0),nz.set(this,void 0),nK.set(this,void 0),nV.set(this,void 0),nJ.set(this,void 0),nH.set(this,void 0),nX.set(this,void 0),nY.set(this,void 0)}[(nB=new WeakMap,nF=new WeakMap,nU=new WeakMap,nW=new WeakMap,nq=new WeakMap,nz=new WeakMap,nK=new WeakMap,nV=new WeakMap,nJ=new WeakMap,nH=new WeakMap,nX=new WeakMap,nY=new WeakMap,nL=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new nD;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=el.fromReadableStream(e,this.controller);for await(let e of r)o(this,nL,"m",nG).call(this,e);if(r.controller.signal?.aborted)throw new p;return this._addRun(o(this,nL,"m",nQ).call(this))}toReadableStream(){return new el(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,r){let n=new nD;return n._run(()=>n._runToolAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.submitToolOutputs(t,a,{...r,signal:this.controller.signal});for await(let e of(this._connected(),i))o(this,nL,"m",nG).call(this,e);if(i.controller.signal?.aborted)throw new p;return this._addRun(o(this,nL,"m",nQ).call(this))}static createThreadAssistantStream(e,t,s){let r=new nD;return r._run(()=>r._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,s,r){let n=new nD;return n._run(()=>n._runAssistantStream(e,t,s,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}currentEvent(){return o(this,nH,"f")}currentRun(){return o(this,nX,"f")}currentMessageSnapshot(){return o(this,nW,"f")}currentRunStepSnapshot(){return o(this,nY,"f")}async finalRunSteps(){return await this.done(),Object.values(o(this,nF,"f"))}async finalMessages(){return await this.done(),Object.values(o(this,nU,"f"))}async finalRun(){if(await this.done(),!o(this,nq,"f"))throw Error("Final run was not received.");return o(this,nq,"f")}async _createThreadAssistantStream(e,t,s){let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let n={...t,stream:!0},a=await e.createAndRun(n,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))o(this,nL,"m",nG).call(this,e);if(a.controller.signal?.aborted)throw new p;return this._addRun(o(this,nL,"m",nQ).call(this))}async _createAssistantStream(e,t,s,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.create(t,a,{...r,signal:this.controller.signal});for await(let e of(this._connected(),i))o(this,nL,"m",nG).call(this,e);if(i.controller.signal?.aborted)throw new p;return this._addRun(o(this,nL,"m",nQ).call(this))}static accumulateDelta(e,t){for(let[s,r]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=r;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=r;continue}if("string"==typeof t&&"string"==typeof r)t+=r;else if("number"==typeof t&&"number"==typeof r)t+=r;else if(E(t)&&E(r))t=this.accumulateDelta(t,r);else if(Array.isArray(t)&&Array.isArray(r)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...r);continue}for(let e of r){if(!E(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let r=t[s];null==r?t.push(e):t[s]=this.accumulateDelta(r,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${r}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,r){return await this._createAssistantStream(t,e,s,r)}async _runToolAssistantStream(e,t,s,r){return await this._createToolAssistantStream(t,e,s,r)}}nD=tf,nG=function(e){if(!this.ended)switch(i(this,nH,e,"f"),o(this,nL,"m",n2).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":o(this,nL,"m",n5).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":o(this,nL,"m",n1).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":o(this,nL,"m",n0).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},nQ=function(){if(this.ended)throw new u("stream has ended, this shouldn't happen");if(!o(this,nq,"f"))throw Error("Final run has not been received");return o(this,nq,"f")},n0=function(e){let[t,s]=o(this,nL,"m",n9).call(this,e,o(this,nW,"f"));for(let e of(i(this,nW,t,"f"),o(this,nU,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,r=t.content[s.index];if(r&&"text"==r.type)this._emit("textDelta",e,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=o(this,nz,"f")){if(o(this,nK,"f"))switch(o(this,nK,"f").type){case"text":this._emit("textDone",o(this,nK,"f").text,o(this,nW,"f"));break;case"image_file":this._emit("imageFileDone",o(this,nK,"f").image_file,o(this,nW,"f"))}i(this,nz,s.index,"f")}i(this,nK,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==o(this,nz,"f")){let t=e.data.content[o(this,nz,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,o(this,nW,"f"));break;case"text":this._emit("textDone",t.text,o(this,nW,"f"))}}o(this,nW,"f")&&this._emit("messageDone",e.data),i(this,nW,void 0,"f")}},n1=function(e){let t=o(this,nL,"m",n4).call(this,e);switch(i(this,nY,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==o(this,nV,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(o(this,nJ,"f")&&this._emit("toolCallDone",o(this,nJ,"f")),i(this,nV,e.index,"f"),i(this,nJ,t.step_details.tool_calls[e.index],"f"),o(this,nJ,"f")&&this._emit("toolCallCreated",o(this,nJ,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":i(this,nY,void 0,"f"),"tool_calls"==e.data.step_details.type&&o(this,nJ,"f")&&(this._emit("toolCallDone",o(this,nJ,"f")),i(this,nJ,void 0,"f")),this._emit("runStepDone",e.data,t)}},n2=function(e){o(this,nB,"f").push(e),this._emit("event",e)},n4=function(e){switch(e.event){case"thread.run.step.created":return o(this,nF,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=o(this,nF,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let r=nD.accumulateDelta(t,s.delta);o(this,nF,"f")[e.data.id]=r}return o(this,nF,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":o(this,nF,"f")[e.data.id]=e.data}if(o(this,nF,"f")[e.data.id])return o(this,nF,"f")[e.data.id];throw Error("No snapshot available")},n9=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(let e of r.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=o(this,nL,"m",n3).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},n3=function(e,t){return nD.accumulateDelta(t,e)},n5=function(e){switch(i(this,nX,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":i(this,nq,e.data,"f"),o(this,nJ,"f")&&(this._emit("toolCallDone",o(this,nJ,"f")),i(this,nJ,void 0,"f"))}};class tm extends ej{constructor(){super(...arguments),this.steps=new th(this._client)}create(e,t,s){let{include:r,...n}=t;return this._client.post(eM`/threads/${e}/runs`,{query:{include:r},body:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:r}=t;return this._client.get(eM`/threads/${r}/runs/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:r,...n}=t;return this._client.post(eM`/threads/${r}/runs/${e}`,{body:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(eM`/threads/${e}/runs`,e_,{query:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:r}=t;return this._client.post(eM`/threads/${r}/runs/${e}/cancel`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(r.id,{thread_id:e},s)}createAndStream(e,t,s){return tf.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let r=e8([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...r}}).withResponse();switch(n.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await C(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return n}}}stream(e,t,s){return tf.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:r,...n}=t;return this._client.post(eM`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let r=await this.submitToolOutputs(e,t,s);return await this.poll(r.id,t,s)}submitToolOutputsStream(e,t,s){return tf.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}tm.Steps=th;class tg extends ej{constructor(){super(...arguments),this.runs=new tm(this._client),this.messages=new tu(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eM`/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(eM`/threads/${e}`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(eM`/threads/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return tf.createThreadAssistantStream(e,this._client.beta.threads,t)}}tg.Runs=tm,tg.Messages=tu;class ty extends ej{constructor(){super(...arguments),this.realtime=new to(this._client),this.chatkit=new td(this._client),this.assistants=new tn(this._client),this.threads=new tg(this._client)}}ty.Realtime=to,ty.ChatKit=td,ty.Assistants=tn,ty.Threads=tg;class t_ extends ej{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tv extends ej{retrieve(e,t,s){let{container_id:r}=t;return this._client.get(eM`/containers/${r}/files/${e}/content`,{...s,headers:e8([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class tb extends ej{constructor(){super(...arguments),this.content=new tv(this._client)}create(e,t,s){return this._client.post(eM`/containers/${e}/files`,eO({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:r}=t;return this._client.get(eM`/containers/${r}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(eM`/containers/${e}/files`,e_,{query:t,...s})}delete(e,t,s){let{container_id:r}=t;return this._client.delete(eM`/containers/${r}/files/${e}`,{...s,headers:e8([{Accept:"*/*"},s?.headers])})}}tb.Content=tv;class tw extends ej{constructor(){super(...arguments),this.files=new tb(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(eM`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",e_,{query:e,...t})}delete(e,t){return this._client.delete(eM`/containers/${e}`,{...t,headers:e8([{Accept:"*/*"},t?.headers])})}}tw.Files=tb;class tx extends ej{create(e,t,s){let{include:r,...n}=t;return this._client.post(eM`/conversations/${e}/items`,{query:{include:r},body:n,...s})}retrieve(e,t,s){let{conversation_id:r,...n}=t;return this._client.get(eM`/conversations/${r}/items/${e}`,{query:n,...s})}list(e,t={},s){return this._client.getAPIList(eM`/conversations/${e}/items`,ev,{query:t,...s})}delete(e,t,s){let{conversation_id:r}=t;return this._client.delete(eM`/conversations/${r}/items/${e}`,s)}}class tk extends ej{constructor(){super(...arguments),this.items=new tx(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(eM`/conversations/${e}`,t)}update(e,t,s){return this._client.post(eM`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(eM`/conversations/${e}`,t)}}tk.Items=tx;class tS extends ej{create(e,t){let s=!!e.encoding_format,r=s?e.encoding_format:"base64";s&&ei(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let n=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return s?n:(ei(this._client).debug("embeddings/decoding base64 embeddings from base64"),n._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return Array.from(new Float32Array(r.buffer))}})(t)}),e)))}}class tO extends ej{retrieve(e,t,s){let{eval_id:r,run_id:n}=t;return this._client.get(eM`/evals/${r}/runs/${n}/output_items/${e}`,s)}list(e,t,s){let{eval_id:r,...n}=t;return this._client.getAPIList(eM`/evals/${r}/runs/${e}/output_items`,e_,{query:n,...s})}}class tA extends ej{constructor(){super(...arguments),this.outputItems=new tO(this._client)}create(e,t,s){return this._client.post(eM`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:r}=t;return this._client.get(eM`/evals/${r}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(eM`/evals/${e}/runs`,e_,{query:t,...s})}delete(e,t,s){let{eval_id:r}=t;return this._client.delete(eM`/evals/${r}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:r}=t;return this._client.post(eM`/evals/${r}/runs/${e}`,s)}}tA.OutputItems=tO;class t$ extends ej{constructor(){super(...arguments),this.runs=new tA(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(eM`/evals/${e}`,t)}update(e,t,s){return this._client.post(eM`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",e_,{query:e,...t})}delete(e,t){return this._client.delete(eM`/evals/${e}`,t)}}t$.Runs=tA;class tI extends ej{create(e,t){return this._client.post("/files",eO({body:e,...t},this._client))}retrieve(e,t){return this._client.get(eM`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",e_,{query:e,...t})}delete(e,t){return this._client.delete(eM`/files/${e}`,t)}content(e,t){return this._client.get(eM`/files/${e}/content`,{...t,headers:e8([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let r=new Set(["processed","error","deleted"]),n=Date.now(),a=await this.retrieve(e);for(;!a.status||!r.has(a.status);)if(await C(t),a=await this.retrieve(e),Date.now()-n>s)throw new m({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class tT extends ej{}class tR extends ej{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class tE extends ej{constructor(){super(...arguments),this.graders=new tR(this._client)}}tE.Graders=tR;class tC extends ej{create(e,t,s){return this._client.getAPIList(eM`/fine_tuning/checkpoints/${e}/permissions`,ey,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(eM`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:r}=t;return this._client.delete(eM`/fine_tuning/checkpoints/${r}/permissions/${e}`,s)}}class tP extends ej{constructor(){super(...arguments),this.permissions=new tC(this._client)}}tP.Permissions=tC;class tj extends ej{list(e,t={},s){return this._client.getAPIList(eM`/fine_tuning/jobs/${e}/checkpoints`,e_,{query:t,...s})}}class tN extends ej{constructor(){super(...arguments),this.checkpoints=new tj(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(eM`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",e_,{query:e,...t})}cancel(e,t){return this._client.post(eM`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(eM`/fine_tuning/jobs/${e}/events`,e_,{query:t,...s})}pause(e,t){return this._client.post(eM`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(eM`/fine_tuning/jobs/${e}/resume`,t)}}tN.Checkpoints=tj;class tZ extends ej{constructor(){super(...arguments),this.methods=new tT(this._client),this.jobs=new tN(this._client),this.checkpoints=new tP(this._client),this.alpha=new tE(this._client)}}tZ.Methods=tT,tZ.Jobs=tN,tZ.Checkpoints=tP,tZ.Alpha=tE;class tM extends ej{}class tL extends ej{constructor(){super(...arguments),this.graderModels=new tM(this._client)}}tL.GraderModels=tM;class tD extends ej{createVariation(e,t){return this._client.post("/images/variations",eO({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",eO({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class tB extends ej{retrieve(e,t){return this._client.get(eM`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ey,e)}delete(e,t){return this._client.delete(eM`/models/${e}`,t)}}class tF extends ej{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class tU extends ej{accept(e,t,s){return this._client.post(eM`/realtime/calls/${e}/accept`,{body:t,...s,headers:e8([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(eM`/realtime/calls/${e}/hangup`,{...t,headers:e8([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(eM`/realtime/calls/${e}/refer`,{body:t,...s,headers:e8([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(eM`/realtime/calls/${e}/reject`,{body:t,...s,headers:e8([{Accept:"*/*"},s?.headers])})}}class tW extends ej{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class tq extends ej{constructor(){super(...arguments),this.clientSecrets=new tW(this._client),this.calls=new tU(this._client)}}function tz(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,r;let n=(s=e.tools??[],r=t.name,s.find(e=>"function"===e.type&&e.name===r));return{...t,...t,parsed_arguments:n?.$brand==="auto-parseable-tool"?n.$parseRaw(t.arguments):n?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,r;return"output_text"===e.type?{...e,parsed:(s=t,r=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:s}}return e}),r=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||tK(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let e of r.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),r}function tK(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}tq.ClientSecrets=tW,tq.Calls=tU;class tV extends eV{constructor(e){super(),n6.add(this),n8.set(this,void 0),n7.set(this,void 0),ae.set(this,void 0),i(this,n8,e,"f")}static createResponse(e,t,s){let r=new tV(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),o(this,n6,"m",at).call(this);let a=null;for await(let n of("response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),r))o(this,n6,"m",as).call(this,n,a);if(r.controller.signal?.aborted)throw new p;return o(this,n6,"m",ar).call(this)}[(n8=new WeakMap,n7=new WeakMap,ae=new WeakMap,n6=new WeakSet,at=function(){this.ended||i(this,n7,void 0,"f")},as=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},r=o(this,n6,"m",an).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=r.output[e.output_index];if(!t)throw new u(`missing output at index ${e.output_index}`);if("message"===t.type){let r=t.content[e.content_index];if(!r)throw new u(`missing content at index ${e.content_index}`);if("output_text"!==r.type)throw new u(`expected content to be 'output_text', got ${r.type}`);s("response.output_text.delta",{...e,snapshot:r.text})}break}case"response.function_call_arguments.delta":{let t=r.output[e.output_index];if(!t)throw new u(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ar=function(){if(this.ended)throw new u("stream has ended, this shouldn't happen");let e=o(this,n7,"f");if(!e)throw new u("request ended without sending any events");i(this,n7,void 0,"f");let t=function(e,t){var s;return t&&(s=t,eB(s.text?.format))?tz(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,o(this,n8,"f"));return i(this,ae,t,"f"),t},an=function(e){let t=o(this,n7,"f");if(!t){if("response.created"!==e.type)throw new u(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return i(this,n7,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new u(`missing output at index ${e.output_index}`);let r=s.type,n=e.part;"message"===r&&"reasoning_text"!==n.type?s.content.push(n):"reasoning"===r&&"reasoning_text"===n.type&&(s.content||(s.content=[]),s.content.push(n));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new u(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new u(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new u(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new u(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new u(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new u(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new u(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":i(this,n7,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=o(this,ae,"f");if(!e)throw new u("stream ended without producing a ChatCompletion");return e}}class tJ extends ej{list(e,t={},s){return this._client.getAPIList(eM`/responses/${e}/input_items`,e_,{query:t,...s})}}class tH extends ej{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class tX extends ej{constructor(){super(...arguments),this.inputItems=new tJ(this._client),this.inputTokens=new tH(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&tK(e),e))}retrieve(e,t={},s){return this._client.get(eM`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&tK(e),e))}delete(e,t){return this._client.delete(eM`/responses/${e}`,{...t,headers:e8([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>tz(t,e))}stream(e,t){return tV.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(eM`/responses/${e}/cancel`,t)}}tX.InputItems=tJ,tX.InputTokens=tH;class tY extends ej{create(e,t,s){return this._client.post(eM`/uploads/${e}/parts`,eO({body:t,...s},this._client))}}class tG extends ej{constructor(){super(...arguments),this.parts=new tY(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(eM`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(eM`/uploads/${e}/complete`,{body:t,...s})}}tG.Parts=tY;let tQ=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let r=[];for(let e of t)"fulfilled"===e.status&&r.push(e.value);return r};class t0 extends ej{create(e,t,s){return this._client.post(eM`/vector_stores/${e}/file_batches`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(eM`/vector_stores/${r}/file_batches/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:r}=t;return this._client.post(eM`/vector_stores/${r}/file_batches/${e}/cancel`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t);return await this.poll(e,r.id,s)}listFiles(e,t,s){let{vector_store_id:r,...n}=t;return this._client.getAPIList(eM`/vector_stores/${r}/file_batches/${e}/files`,e_,{query:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let r=e8([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:n,response:a}=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse();switch(n.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await C(i);break;case"failed":case"cancelled":case"completed":return n}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},r){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let n=Math.min(r?.maxConcurrency??5,t.length),a=this._client,i=t.values(),o=[...s];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},r);o.push(e.id)}}let c=Array(n).fill(i).map(l);return await tQ(c),await this.createAndPoll(e,{file_ids:o})}}class t1 extends ej{create(e,t,s){return this._client.post(eM`/vector_stores/${e}/files`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:r}=t;return this._client.get(eM`/vector_stores/${r}/files/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:r,...n}=t;return this._client.post(eM`/vector_stores/${r}/files/${e}`,{body:n,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(eM`/vector_stores/${e}/files`,e_,{query:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:r}=t;return this._client.delete(eM`/vector_stores/${r}/files/${e}`,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let r=await this.create(e,t,s);return await this.poll(e,r.id,s)}async poll(e,t,s){let r=e8([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let n=await this.retrieve(t,{vector_store_id:e},{...s,headers:r}).withResponse(),a=n.data;switch(a.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=n.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await C(i);break;case"failed":case"completed":return a}}}async upload(e,t,s){let r=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:r.id},s)}async uploadAndPoll(e,t,s){let r=await this.upload(e,t,s);return await this.poll(e,r.id,s)}content(e,t,s){let{vector_store_id:r}=t;return this._client.getAPIList(eM`/vector_stores/${r}/files/${e}/content`,ey,{...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class t2 extends ej{constructor(){super(...arguments),this.files=new t1(this._client),this.fileBatches=new t0(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(eM`/vector_stores/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(eM`/vector_stores/${e}`,{body:t,...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",e_,{query:e,...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(eM`/vector_stores/${e}`,{...t,headers:e8([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(eM`/vector_stores/${e}/search`,ey,{body:t,method:"post",...s,headers:e8([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}t2.Files=t1,t2.FileBatches=t0;class t4 extends ej{create(e,t){return this._client.post("/videos",eS({body:e,...t},this._client))}retrieve(e,t){return this._client.get(eM`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",ev,{query:e,...t})}delete(e,t){return this._client.delete(eM`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(eM`/videos/${e}/content`,{query:t,...s,headers:e8([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(eM`/videos/${e}/remix`,eS({body:t,...s},this._client))}}class t9 extends ej{constructor(){super(...arguments),aa.add(this)}async unwrap(e,t,s=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,s,r),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");o(this,aa,"m",ai).call(this,s);let n=e8([t]).values,a=o(this,aa,"m",ao).call(this,n,"webhook-signature"),i=o(this,aa,"m",ao).call(this,n,"webhook-timestamp"),l=o(this,aa,"m",ao).call(this,n,"webhook-id"),c=parseInt(i,10);if(isNaN(c))throw new A("Invalid webhook timestamp format");let d=Math.floor(Date.now()/1e3);if(d-c>r)throw new A("Webhook timestamp is too old");if(c>d+r)throw new A("Webhook timestamp is too new");let u=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),h=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),p=l?`${l}.${i}.${e}`:`${i}.${e}`,f=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(p)))return}catch{continue}throw new A("The given webhook signature does not match the expected signature")}}aa=new WeakSet,ai=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ao=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s},e.i(98546);class t3{constructor({baseURL:e=tp("OPENAI_BASE_URL"),apiKey:t=tp("OPENAI_API_KEY"),organization:s=tp("OPENAI_ORG_ID")??null,project:r=tp("OPENAI_PROJECT_ID")??null,webhookSecret:n=tp("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(al.add(this),ad.set(this,void 0),this.completions=new t_(this),this.chat=new e5(this),this.embeddings=new tS(this),this.files=new tI(this),this.images=new tD(this),this.audio=new ts(this),this.moderations=new tF(this),this.models=new tB(this),this.fineTuning=new tZ(this),this.graders=new tL(this),this.vectorStores=new t2(this),this.webhooks=new t9(this),this.beta=new ty(this),this.batches=new tr(this),this.uploads=new tG(this),this.responses=new tX(this),this.realtime=new tq(this),this.conversations=new tk(this),this.evals=new t$(this),this.containers=new tw(this),this.videos=new t4(this),void 0===t)throw new u("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:t,organization:s,project:r,webhookSecret:n,...a,baseURL:e||"https://api.openai.com/v1"};o.dangerouslyAllowBrowser,this.baseURL=o.baseURL,this.timeout=o.timeout??ac.DEFAULT_TIMEOUT,this.logger=o.logger??console;const l="warn";this.logLevel=l,this.logLevel=et(o.logLevel,"ClientOptions.logLevel",this)??et(tp("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),i(this,ad,B,"f"),this._options=o,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=r,this.webhookSecret=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return e8([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,r=e,n=function(e=H){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||H.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=F;if(void 0!==e.format){if(!q(W,e.format))throw TypeError("Unknown format option provided.");r=e.format}let n=W[r],a=H.filter;if(("function"==typeof e.filter||I(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in V?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":H.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||H.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:H.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:H.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:H.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?H.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:H.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:H.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:H.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:H.encodeValuesOnly,filter:a,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:H.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:H.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:H.strictNullHandling}}(t);"function"==typeof n.filter?r=(0,n.filter)("",r):I(n.filter)&&(s=n.filter);let a=[];if("object"!=typeof r||null===r)return"";let i=V[n.arrayFormat],o="comma"===i&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];n.skipNulls&&null===r[t]||J(a,function e(t,s,r,n,a,i,o,l,c,d,u,h,p,f,m,g,y,_){var v,b;let w,x=t,k=_,S=0,O=!1;for(;void 0!==(k=k.get(X))&&!O;){let e=k.get(t);if(S+=1,void 0!==e)if(e===S)throw RangeError("Cyclic object value");else O=!0;void 0===k.get(X)&&(S=0)}if("function"==typeof d?x=d(s,x):x instanceof Date?x=p?.(x):"comma"===r&&I(x)&&(x=K(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(i)return c&&!g?c(s,H.encoder,y,"key",f):s;x=""}if("string"==typeof(v=x)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,H.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,H.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let A=[];if(void 0===x)return A;if("comma"===r&&I(x))g&&c&&(x=K(x,c)),w=[{value:x.length>0?x.join(",")||null:void 0}];else if(I(d))w=d;else{let e=Object.keys(x);w=u?e.sort(u):e}let $=l?String(s).replace(/\./g,"%2E"):String(s),T=n&&I(x)&&1===x.length?$+"[]":$;if(a&&I(x)&&0===x.length)return T+"[]";for(let s=0;s<w.length;++s){let v=w[s],b="object"==typeof v&&void 0!==v.value?v.value:x[v];if(o&&null===b)continue;let k=h&&l?v.replace(/\./g,"%2E"):v,O=I(x)?"function"==typeof r?r(T,k):T:T+(h?"."+k:"["+k+"]");_.set(t,S);let $=new WeakMap;$.set(X,_),J(A,e(b,O,r,n,a,i,o,l,"comma"===r&&g&&I(x)?null:c,d,u,h,p,f,m,g,y,$))}return A}(r[t],t,i,o,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let c=a.join(n.delimiter),d=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${P}`}defaultIdempotencyKey(){return`stainless-node-retry-${l()}`}makeStatusError(e,t,s,r){return h.generate(e,t,s,r)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof u)throw e;throw new u(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new u(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let r=!o(this,al,"m",au).call(this)&&s||this.baseURL,n=new URL($.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new ef(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(a,{url:i,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),u=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(ei(this).debug(`[${l}] sending request`,eo({retryOfRequestLogID:s,method:r.method,url:i,options:r,headers:a.headers})),r.signal?.aborted)throw new p;let g=new AbortController,y=await this.fetchWithTimeout(i,a,o,g).catch(d),_=Date.now();if(y instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new p;let n=c(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return ei(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),ei(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,eo({retryOfRequestLogID:s,url:i,durationMs:_-h,message:y.message})),this.retryRequest(r,t,s??l);if(ei(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),ei(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,eo({retryOfRequestLogID:s,url:i,durationMs:_-h,message:y.message})),n)throw new m;throw new f({cause:y})}let v=[...y.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),b=`[${l}${u}${v}] ${a.method} ${i} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${_-h}ms`;if(!y.ok){let e=await this.shouldRetry(y);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await D(y.body),ei(this).info(`${b} - ${e}`),ei(this).debug(`[${l}] response error (${e})`,eo({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:_-h})),this.retryRequest(r,t,s??l,y.headers)}let n=e?"error; no more retries left":"error; not retryable";ei(this).info(`${b} - ${n}`);let a=await y.text().catch(e=>d(e).message),i=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=i?void 0:a;throw ei(this).debug(`[${l}] response error (${n})`,eo({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(y.status,i,o,y.headers)}return ei(this).info(b),ei(this).debug(`[${l}] response start`,eo({retryOfRequestLogID:s,url:y.url,status:y.status,headers:y.headers,durationMs:_-h})),{response:y,options:r,controller:g,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new eg(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:a,...i}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n,a=r?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(n=e)}let i=r?.get("retry-after");if(i&&!n){let e=parseFloat(i);n=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await C(n),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:a,defaultBaseURL:i}=s,o=this.buildURL(n,a,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new u(`${e} must be an integer`);if(t<0)throw new u(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),d=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:d,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:s,bodyHeaders:r,retryCount:n}){let a={};this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let i=e8([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...t??(t=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":N(Deno.build.os),"X-Stainless-Arch":j(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":N(globalThis.process.platform??"unknown"),"X-Stainless-Arch":j(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=e8([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:M(e)}:o(this,ad,"f").call(this,{body:e,headers:s})}}ac=t3,ad=new WeakMap,al=new WeakSet,au=function(){return"https://api.openai.com/v1"!==this.baseURL},t3.OpenAI=ac,t3.DEFAULT_TIMEOUT=6e5,t3.OpenAIError=u,t3.APIError=h,t3.APIConnectionError=f,t3.APIConnectionTimeoutError=m,t3.APIUserAbortError=p,t3.NotFoundError=v,t3.ConflictError=b,t3.RateLimitError=x,t3.BadRequestError=g,t3.AuthenticationError=y,t3.InternalServerError=k,t3.PermissionDeniedError=_,t3.UnprocessableEntityError=w,t3.InvalidWebhookSignatureError=A,t3.toFile=eC,t3.Completions=t_,t3.Chat=e5,t3.Embeddings=tS,t3.Files=tI,t3.Images=tD,t3.Audio=ts,t3.Moderations=tF,t3.Models=tB,t3.FineTuning=tZ,t3.Graders=tL,t3.VectorStores=t2,t3.Webhooks=t9,t3.Beta=ty,t3.Batches=tr,t3.Uploads=tG,t3.Responses=tX,t3.Realtime=tq,t3.Conversations=tk,t3.Evals=t$,t3.Containers=tw,t3.Videos=t4;let t5=new t3({baseURL:"https://openrouter.ai/api/v1",apiKey:process.env.OPENROUTER_API_KEY});async function t6(e){let t=`
You are an expert instructional designer and teacher mentor.

Your job:
1. Read the entire conversation history.
2. Understand the teachers intent:
   - Subject
   - Grade level
   - Learning goals
   - Required activities
3. Produce a very clear and clean lesson outline, with the following structure:

Lesson Topic: <topic>
Grade Level: <grade or "not stated">
Learning Objectives:
- Objective 1
- Objective 2
- ...

Lesson Outline:
1. Introduction
2. Concept Explanation
3. Guided Practice
4. Independent Practice
5. Assessment (questions or quiz)
6. Conclusion

Rules:
- Do NOT generate any JSON.
- Do NOT create full SCORM blocks.
- Only produce a text outline for the architect agent to use.
- Keep the outline simple and structured.
`;return(await t5.chat.completions.create({model:"allenai/olmo-3-32b:think",messages:[{role:"system",content:t},...e],temperature:.4})).choices[0].message.content}let t8=new t3({baseURL:"https://openrouter.ai/api/v1",apiKey:process.env.OPENROUTER_API_KEY});async function t7(e){let t=`
You are a SCORM lesson architect.

Your task:
Convert the teachers lesson outline into a structured SCORM lesson blueprint.
DO NOT generate final JSON  only structured natural language that describes the project.

The lesson blueprint must follow this structure:

Lesson Title: <title>

Pages:
- Page 1: <title>
  Blocks:
    - Text: <introduction/overview>
    - Image: <placeholder description>
- Page 2: <concept section>
  Blocks:
    - Text: <explanation>
    - Quiz:
        type: mcq
        question: <question>
        options: [A, B, C, D]
        answer: <letter>
- Page 3: Guided Practice
  Blocks:
    - Text: <task instructions>

- Page 4: Independent Practice
  Blocks:
    - Text: <exercise>

- Page 5: Conclusion
  Blocks:
    - Text: <summary>

Rules:
- Keep the structure clean and organized.
- DO NOT output JSON.
- DO NOT add IDs. Normalizer will handle that.
- Use placeholders like Image: diagram of .
- Use simple quiz examples.
`;return(await t8.chat.completions.create({model:"Kwai-KAT-6B:free",messages:[{role:"system",content:t},{role:"user",content:e}],temperature:.3})).choices[0].message.content}async function se(e){let t=new t3({baseURL:"https://openrouter.ai/api/v1",apiKey:process.env.OPENROUTER_API_KEY}),s=`
You are an advanced education specialist.

Your task:
Take the architect's lesson blueprint and expand it with:

- Clear explanations
- Real-world examples
- Guided practice steps
- Independent practice tasks
- Optional hints
- Teacher notes for differentiation
- A small assessment section for each key concept

Rules:
- DO NOT output any JSON.
- DO NOT modify the structure (pages + blocks).
- Only enrich the content inside each block.
- Keep everything clean, readable, and suitable for automatic conversion.
- Avoid overlong paragraphs; use concise teaching style.
`;return(await t.chat.completions.create({model:"openai/gpt-4o-mini-tts",messages:[{role:"system",content:s},{role:"user",content:e}],temperature:.4})).choices[0].message.content}function st(e){return e?e.replace(/\r/g,"").replace(/\t/g," ").replace(/[<>]/g,"").replace(/\s+/g," ").trim():""}e.s([],54033),e.i(54033),(r6=ah||(ah={})).assertEqual=e=>{},r6.assertIs=function(e){},r6.assertNever=function(e){throw Error()},r6.arrayToEnum=e=>{let t={};for(let s of e)t[s]=s;return t},r6.getValidEnumValues=e=>{let t=r6.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),s={};for(let r of t)s[r]=e[r];return r6.objectValues(s)},r6.objectValues=e=>r6.objectKeys(e).map(function(t){return e[t]}),r6.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},r6.find=(e,t)=>{for(let s of e)if(t(s))return s},r6.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,r6.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},r6.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(ap||(ap={})).mergeShapes=(e,t)=>({...e,...t});let ss=ah.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),sr=e=>{switch(typeof e){case"undefined":return ss.undefined;case"string":return ss.string;case"number":return Number.isNaN(e)?ss.nan:ss.number;case"boolean":return ss.boolean;case"function":return ss.function;case"bigint":return ss.bigint;case"symbol":return ss.symbol;case"object":if(Array.isArray(e))return ss.array;if(null===e)return ss.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return ss.promise;if("undefined"!=typeof Map&&e instanceof Map)return ss.map;if("undefined"!=typeof Set&&e instanceof Set)return ss.set;if("undefined"!=typeof Date&&e instanceof Date)return ss.date;return ss.object;default:return ss.unknown}};e.s(["ZodParsedType",0,ss,"getParsedType",0,sr,"objectUtil",()=>ap,"util",()=>ah],42944);let sn=ah.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),sa=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class si extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},s={_errors:[]},r=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(r);else if("invalid_return_type"===n.code)r(n.returnTypeError);else if("invalid_arguments"===n.code)r(n.argumentsError);else if(0===n.path.length)s._errors.push(t(n));else{let e=s,r=0;for(;r<n.path.length;){let s=n.path[r];r===n.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(n))):e[s]=e[s]||{_errors:[]},e=e[s],r++}}};return r(this),s}static assert(e){if(!(e instanceof si))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ah.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},s=[];for(let r of this.issues)if(r.path.length>0){let s=r.path[0];t[s]=t[s]||[],t[s].push(e(r))}else s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}si.create=e=>new si(e),e.s(["ZodError",()=>si,"ZodIssueCode",0,sn,"quotelessJson",0,sa],15235);let so=(e,t)=>{let s;switch(e.code){case sn.invalid_type:s=e.received===ss.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case sn.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,ah.jsonStringifyReplacer)}`;break;case sn.unrecognized_keys:s=`Unrecognized key(s) in object: ${ah.joinValues(e.keys,", ")}`;break;case sn.invalid_union:s="Invalid input";break;case sn.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${ah.joinValues(e.options)}`;break;case sn.invalid_enum_value:s=`Invalid enum value. Expected ${ah.joinValues(e.options)}, received '${e.received}'`;break;case sn.invalid_arguments:s="Invalid function arguments";break;case sn.invalid_return_type:s="Invalid function return type";break;case sn.invalid_date:s="Invalid date";break;case sn.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:ah.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case sn.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case sn.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case sn.custom:s="Invalid input";break;case sn.invalid_intersection_types:s="Intersection results could not be merged";break;case sn.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case sn.not_finite:s="Number must be finite";break;default:s=t.defaultError,ah.assertNever(e)}return{message:s}},sl=so;function sc(e){sl=e}function sd(){return sl}e.s(["getErrorMap",()=>sd,"setErrorMap",()=>sc],85676),e.i(85676),e.s(["defaultErrorMap",0,so,"getErrorMap",()=>sd,"setErrorMap",()=>sc],76733),e.i(76733);let su=e=>{let{data:t,path:s,errorMaps:r,issueData:n}=e,a=[...s,...n.path||[]],i={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";for(let e of r.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...n,path:a,message:o}},sh=[];function sp(e,t){let s=sl,r=su({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===so?void 0:so].filter(e=>!!e)});e.common.issues.push(r)}class sf{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let r of t){if("aborted"===r.status)return sm;"dirty"===r.status&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let e of t){let t=await e.key,r=await e.value;s.push({key:t,value:r})}return sf.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let r of t){let{key:t,value:n}=r;if("aborted"===t.status||"aborted"===n.status)return sm;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||r.alwaysSet)&&(s[t.value]=n.value)}return{status:e.value,value:s}}}let sm=Object.freeze({status:"aborted"}),sg=e=>({status:"dirty",value:e}),sy=e=>({status:"valid",value:e}),s_=e=>"aborted"===e.status,sv=e=>"dirty"===e.status,sb=e=>"valid"===e.status,sw=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,sg,"EMPTY_PATH",0,sh,"INVALID",0,sm,"OK",0,sy,"ParseStatus",()=>sf,"addIssueToContext",()=>sp,"isAborted",0,s_,"isAsync",0,sw,"isDirty",0,sv,"isValid",0,sb,"makeIssue",0,su],84488),e.i(84488),e.s([],91316),e.i(91316),e.i(42944),(r8=af||(af={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},r8.toString=e=>"string"==typeof e?e:e?.message;class sx{constructor(e,t,s,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let sk=(e,t)=>{if(sb(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new si(e.common.issues);return this._error=t,this._error}}};function sS(e){if(!e)return{};let{errorMap:t,invalid_type_error:s,required_error:r,description:n}=e;if(t&&(s||r))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:a}=e;return"invalid_enum_value"===t.code?{message:a??n.defaultError}:void 0===n.data?{message:a??r??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:a??s??n.defaultError}},description:n}}class sO{get description(){return this._def.description}_getType(e){return sr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:sr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new sf,ctx:{common:e.parent.common,data:e.data,parsedType:sr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(sw(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)},r=this._parseSync({data:e,path:s.path,parent:s});return sk(s,r)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return sb(s)?{value:s.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>sb(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)},r=this._parse({data:e,path:s.path,parent:s});return sk(s,await (sw(r)?r:Promise.resolve(r)))}refine(e,t){return this._refinement((s,r)=>{let n=e(s),a=()=>r.addIssue({code:sn.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(s):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((s,r)=>!!e(s)||(r.addIssue("function"==typeof t?t(s,r):t),!1))}_refinement(e){return new rc({schema:this,typeName:am.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return rd.create(this,this._def)}nullable(){return ru.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return s2.create(this)}promise(){return rl.create(this,this._def)}or(e){return s9.create([this,e],this._def)}and(e){return s6.create(this,e,this._def)}transform(e){return new rc({...sS(this._def),schema:this,typeName:am.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new rh({...sS(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:am.ZodDefault})}brand(){return new rg({typeName:am.ZodBranded,type:this,...sS(this._def)})}catch(e){return new rp({...sS(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:am.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ry.create(this,e)}readonly(){return r_.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let sA=/^c[^\s-]{8,}$/i,s$=/^[0-9a-z]+$/,sI=/^[0-9A-HJKMNP-TV-Z]{26}$/i,sT=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,sR=/^[a-z0-9_-]{21}$/i,sE=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,sC=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,sP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,sj=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sZ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,sM=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,sL=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,sD=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,sB="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",sF=RegExp(`^${sB}$`);function sU(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let s=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${s}`}function sW(e){let t=`${sB}T${sU(e)}`,s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,RegExp(`^${t}$`)}class sq extends sO{_parse(e){var t,s,r,n;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ss.string){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.string,received:t.parsedType}),sm}let o=new sf;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(sp(i=this._getOrReturnCtx(e,i),{code:sn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(sp(i=this._getOrReturnCtx(e,i),{code:sn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,s=e.data.length<l.value;(t||s)&&(i=this._getOrReturnCtx(e,i),t?sp(i,{code:sn.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):s&&sp(i,{code:sn.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)sP.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"email",code:sn.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:sn.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)sT.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:sn.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)sR.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:sn.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)sA.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:sn.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)s$.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:sn.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)sI.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:sn.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{sp(i=this._getOrReturnCtx(e,i),{validation:"url",code:sn.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"regex",code:sn.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?sW(l).test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?sF.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${sU(l)}$`).test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{code:sn.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?sC.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"duration",code:sn.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(s=l.version)||!s)&&sj.test(t)||("v6"===s||!s)&&sZ.test(t))&&1&&(sp(i=this._getOrReturnCtx(e,i),{validation:"ip",code:sn.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!sE.test(e))return!1;try{let[s]=e.split(".");if(!s)return!1;let r=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),n=JSON.parse(atob(r));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(sp(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:sn.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(r=e.data,!(("v4"===(n=l.version)||!n)&&sN.test(r)||("v6"===n||!n)&&sM.test(r))&&1&&(sp(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:sn.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?sL.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"base64",code:sn.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?sD.test(e.data)||(sp(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:sn.invalid_string,message:l.message}),o.dirty()):ah.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,s){return this.refinement(t=>e.test(t),{validation:t,code:sn.invalid_string,...af.errToObj(s)})}_addCheck(e){return new sq({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...af.errToObj(e)})}url(e){return this._addCheck({kind:"url",...af.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...af.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...af.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...af.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...af.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...af.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...af.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...af.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...af.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...af.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...af.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...af.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...af.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...af.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...af.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...af.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...af.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...af.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...af.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...af.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...af.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...af.errToObj(t)})}nonempty(e){return this.min(1,af.errToObj(e))}trim(){return new sq({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new sq({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new sq({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}sq.create=e=>new sq({checks:[],typeName:am.ZodString,coerce:e?.coerce??!1,...sS(e)});class sz extends sO{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ss.number){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.number,received:t.parsedType}),sm}let s=new sf;for(let r of this._def.checks)"int"===r.kind?ah.isInteger(e.data)||(sp(t=this._getOrReturnCtx(e,t),{code:sn.invalid_type,expected:"integer",received:"float",message:r.message}),s.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),s.dirty()):"multipleOf"===r.kind?0!==function(e,t){let s=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,n=s>r?s:r;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,r.value)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(sp(t=this._getOrReturnCtx(e,t),{code:sn.not_finite,message:r.message}),s.dirty()):ah.assertNever(r);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,af.toString(t))}gt(e,t){return this.setLimit("min",e,!1,af.toString(t))}lte(e,t){return this.setLimit("max",e,!0,af.toString(t))}lt(e,t){return this.setLimit("max",e,!1,af.toString(t))}setLimit(e,t,s,r){return new sz({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:af.toString(r)}]})}_addCheck(e){return new sz({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:af.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:af.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:af.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:af.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:af.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:af.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:af.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:af.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:af.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&ah.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks)if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;else"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value);return Number.isFinite(t)&&Number.isFinite(e)}}sz.create=e=>new sz({checks:[],typeName:am.ZodNumber,coerce:e?.coerce||!1,...sS(e)});class sK extends sO{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ss.bigint)return this._getInvalidInput(e);let s=new sf;for(let r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),s.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.not_multiple_of,multipleOf:r.value,message:r.message}),s.dirty()):ah.assertNever(r);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.bigint,received:t.parsedType}),sm}gte(e,t){return this.setLimit("min",e,!0,af.toString(t))}gt(e,t){return this.setLimit("min",e,!1,af.toString(t))}lte(e,t){return this.setLimit("max",e,!0,af.toString(t))}lt(e,t){return this.setLimit("max",e,!1,af.toString(t))}setLimit(e,t,s,r){return new sK({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:af.toString(r)}]})}_addCheck(e){return new sK({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:af.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:af.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:af.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:af.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:af.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}sK.create=e=>new sK({checks:[],typeName:am.ZodBigInt,coerce:e?.coerce??!1,...sS(e)});class sV extends sO{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ss.boolean){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.boolean,received:t.parsedType}),sm}return sy(e.data)}}sV.create=e=>new sV({typeName:am.ZodBoolean,coerce:e?.coerce||!1,...sS(e)});class sJ extends sO{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ss.date){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.date,received:t.parsedType}),sm}if(Number.isNaN(e.data.getTime()))return sp(this._getOrReturnCtx(e),{code:sn.invalid_date}),sm;let s=new sf;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),s.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(sp(t=this._getOrReturnCtx(e,t),{code:sn.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),s.dirty()):ah.assertNever(r);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new sJ({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:af.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:af.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}sJ.create=e=>new sJ({checks:[],coerce:e?.coerce||!1,typeName:am.ZodDate,...sS(e)});class sH extends sO{_parse(e){if(this._getType(e)!==ss.symbol){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.symbol,received:t.parsedType}),sm}return sy(e.data)}}sH.create=e=>new sH({typeName:am.ZodSymbol,...sS(e)});class sX extends sO{_parse(e){if(this._getType(e)!==ss.undefined){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.undefined,received:t.parsedType}),sm}return sy(e.data)}}sX.create=e=>new sX({typeName:am.ZodUndefined,...sS(e)});class sY extends sO{_parse(e){if(this._getType(e)!==ss.null){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.null,received:t.parsedType}),sm}return sy(e.data)}}sY.create=e=>new sY({typeName:am.ZodNull,...sS(e)});class sG extends sO{constructor(){super(...arguments),this._any=!0}_parse(e){return sy(e.data)}}sG.create=e=>new sG({typeName:am.ZodAny,...sS(e)});class sQ extends sO{constructor(){super(...arguments),this._unknown=!0}_parse(e){return sy(e.data)}}sQ.create=e=>new sQ({typeName:am.ZodUnknown,...sS(e)});class s0 extends sO{_parse(e){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.never,received:t.parsedType}),sm}}s0.create=e=>new s0({typeName:am.ZodNever,...sS(e)});class s1 extends sO{_parse(e){if(this._getType(e)!==ss.undefined){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.void,received:t.parsedType}),sm}return sy(e.data)}}s1.create=e=>new s1({typeName:am.ZodVoid,...sS(e)});class s2 extends sO{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==ss.array)return sp(t,{code:sn.invalid_type,expected:ss.array,received:t.parsedType}),sm;if(null!==r.exactLength){let e=t.data.length>r.exactLength.value,n=t.data.length<r.exactLength.value;(e||n)&&(sp(t,{code:e?sn.too_big:sn.too_small,minimum:n?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(sp(t,{code:sn.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(sp(t,{code:sn.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((e,s)=>r.type._parseAsync(new sx(t,e,t.path,s)))).then(e=>sf.mergeArray(s,e));let n=[...t.data].map((e,s)=>r.type._parseSync(new sx(t,e,t.path,s)));return sf.mergeArray(s,n)}get element(){return this._def.type}min(e,t){return new s2({...this._def,minLength:{value:e,message:af.toString(t)}})}max(e,t){return new s2({...this._def,maxLength:{value:e,message:af.toString(t)}})}length(e,t){return new s2({...this._def,exactLength:{value:e,message:af.toString(t)}})}nonempty(e){return this.min(1,e)}}s2.create=(e,t)=>new s2({type:e,minLength:null,maxLength:null,exactLength:null,typeName:am.ZodArray,...sS(t)});class s4 extends sO{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=ah.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==ss.object){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.object,received:t.parsedType}),sm}let{status:t,ctx:s}=this._processInputParams(e),{shape:r,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof s0&&"strip"===this._def.unknownKeys))for(let e in s.data)n.includes(e)||a.push(e);let i=[];for(let e of n){let t=r[e],n=s.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new sx(s,n,s.path,e)),alwaysSet:e in s.data})}if(this._def.catchall instanceof s0){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)i.push({key:{status:"valid",value:e},value:{status:"valid",value:s.data[e]}});else if("strict"===e)a.length>0&&(sp(s,{code:sn.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let r=s.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new sx(s,r,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let s=await t.key,r=await t.value;e.push({key:s,value:r,alwaysSet:t.alwaysSet})}return e}).then(e=>sf.mergeObjectSync(t,e)):sf.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return af.errToObj,new s4({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{let r=this._def.errorMap?.(t,s).message??s.defaultError;return"unrecognized_keys"===t.code?{message:af.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new s4({...this._def,unknownKeys:"strip"})}passthrough(){return new s4({...this._def,unknownKeys:"passthrough"})}extend(e){return new s4({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new s4({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:am.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new s4({...this._def,catchall:e})}pick(e){let t={};for(let s of ah.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new s4({...this._def,shape:()=>t})}omit(e){let t={};for(let s of ah.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new s4({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof s4){let s={};for(let r in t.shape){let n=t.shape[r];s[r]=rd.create(e(n))}return new s4({...t._def,shape:()=>s})}if(t instanceof s2)return new s2({...t._def,type:e(t.element)});if(t instanceof rd)return rd.create(e(t.unwrap()));if(t instanceof ru)return ru.create(e(t.unwrap()));if(t instanceof s8)return s8.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let s of ah.objectKeys(this.shape)){let r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}return new s4({...this._def,shape:()=>t})}required(e){let t={};for(let s of ah.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof rd;)e=e._def.innerType;t[s]=e}return new s4({...this._def,shape:()=>t})}keyof(){return ra(ah.objectKeys(this.shape))}}s4.create=(e,t)=>new s4({shape:()=>e,unknownKeys:"strip",catchall:s0.create(),typeName:am.ZodObject,...sS(t)}),s4.strictCreate=(e,t)=>new s4({shape:()=>e,unknownKeys:"strict",catchall:s0.create(),typeName:am.ZodObject,...sS(t)}),s4.lazycreate=(e,t)=>new s4({shape:e,unknownKeys:"strip",catchall:s0.create(),typeName:am.ZodObject,...sS(t)});class s9 extends sO{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map(async e=>{let s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let s of e)if("dirty"===s.result.status)return t.common.issues.push(...s.ctx.common.issues),s.result;let s=e.map(e=>new si(e.ctx.common.issues));return sp(t,{code:sn.invalid_union,unionErrors:s}),sm});{let e,r=[];for(let n of s){let s={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:s});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:s}),s.common.issues.length&&r.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=r.map(e=>new si(e));return sp(t,{code:sn.invalid_union,unionErrors:n}),sm}}get options(){return this._def.options}}s9.create=(e,t)=>new s9({options:e,typeName:am.ZodUnion,...sS(t)});let s3=e=>{if(e instanceof rr)return s3(e.schema);if(e instanceof rc)return s3(e.innerType());if(e instanceof rn)return[e.value];if(e instanceof ri)return e.options;if(e instanceof ro)return ah.objectValues(e.enum);else if(e instanceof rh)return s3(e._def.innerType);else if(e instanceof sX)return[void 0];else if(e instanceof sY)return[null];else if(e instanceof rd)return[void 0,...s3(e.unwrap())];else if(e instanceof ru)return[null,...s3(e.unwrap())];else if(e instanceof rg)return s3(e.unwrap());else if(e instanceof r_)return s3(e.unwrap());else if(e instanceof rp)return s3(e._def.innerType);else return[]};class s5 extends sO{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ss.object)return sp(t,{code:sn.invalid_type,expected:ss.object,received:t.parsedType}),sm;let s=this.discriminator,r=t.data[s],n=this.optionsMap.get(r);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(sp(t,{code:sn.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),sm)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let r=new Map;for(let s of t){let t=s3(s.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(r.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);r.set(n,s)}}return new s5({typeName:am.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...sS(s)})}}class s6 extends sO{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),r=(e,r)=>{if(s_(e)||s_(r))return sm;let n=function e(t,s){let r=sr(t),n=sr(s);if(t===s)return{valid:!0,data:t};if(r===ss.object&&n===ss.object){let r=ah.objectKeys(s),n=ah.objectKeys(t).filter(e=>-1!==r.indexOf(e)),a={...t,...s};for(let r of n){let n=e(t[r],s[r]);if(!n.valid)return{valid:!1};a[r]=n.data}return{valid:!0,data:a}}if(r===ss.array&&n===ss.array){if(t.length!==s.length)return{valid:!1};let r=[];for(let n=0;n<t.length;n++){let a=e(t[n],s[n]);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}if(r===ss.date&&n===ss.date&&+t==+s)return{valid:!0,data:t};return{valid:!1}}(e.value,r.value);return n.valid?((sv(e)||sv(r))&&t.dirty(),{status:t.value,value:n.data}):(sp(s,{code:sn.invalid_intersection_types}),sm)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}s6.create=(e,t,s)=>new s6({left:e,right:t,typeName:am.ZodIntersection,...sS(s)});class s8 extends sO{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ss.array)return sp(s,{code:sn.invalid_type,expected:ss.array,received:s.parsedType}),sm;if(s.data.length<this._def.items.length)return sp(s,{code:sn.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),sm;!this._def.rest&&s.data.length>this._def.items.length&&(sp(s,{code:sn.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let r=[...s.data].map((e,t)=>{let r=this._def.items[t]||this._def.rest;return r?r._parse(new sx(s,e,s.path,t)):null}).filter(e=>!!e);return s.common.async?Promise.all(r).then(e=>sf.mergeArray(t,e)):sf.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new s8({...this._def,rest:e})}}s8.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new s8({items:e,typeName:am.ZodTuple,rest:null,...sS(t)})};class s7 extends sO{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ss.object)return sp(s,{code:sn.invalid_type,expected:ss.object,received:s.parsedType}),sm;let r=[],n=this._def.keyType,a=this._def.valueType;for(let e in s.data)r.push({key:n._parse(new sx(s,e,s.path,e)),value:a._parse(new sx(s,s.data[e],s.path,e)),alwaysSet:e in s.data});return s.common.async?sf.mergeObjectAsync(t,r):sf.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return new s7(t instanceof sO?{keyType:e,valueType:t,typeName:am.ZodRecord,...sS(s)}:{keyType:sq.create(),valueType:e,typeName:am.ZodRecord,...sS(t)})}}class re extends sO{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ss.map)return sp(s,{code:sn.invalid_type,expected:ss.map,received:s.parsedType}),sm;let r=this._def.keyType,n=this._def.valueType,a=[...s.data.entries()].map(([e,t],a)=>({key:r._parse(new sx(s,e,s.path,[a,"key"])),value:n._parse(new sx(s,t,s.path,[a,"value"]))}));if(s.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let s of a){let r=await s.key,n=await s.value;if("aborted"===r.status||"aborted"===n.status)return sm;("dirty"===r.status||"dirty"===n.status)&&t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let s of a){let r=s.key,n=s.value;if("aborted"===r.status||"aborted"===n.status)return sm;("dirty"===r.status||"dirty"===n.status)&&t.dirty(),e.set(r.value,n.value)}return{status:t.value,value:e}}}}re.create=(e,t,s)=>new re({valueType:t,keyType:e,typeName:am.ZodMap,...sS(s)});class rt extends sO{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==ss.set)return sp(s,{code:sn.invalid_type,expected:ss.set,received:s.parsedType}),sm;let r=this._def;null!==r.minSize&&s.data.size<r.minSize.value&&(sp(s,{code:sn.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&s.data.size>r.maxSize.value&&(sp(s,{code:sn.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());let n=this._def.valueType;function a(e){let s=new Set;for(let r of e){if("aborted"===r.status)return sm;"dirty"===r.status&&t.dirty(),s.add(r.value)}return{status:t.value,value:s}}let i=[...s.data.values()].map((e,t)=>n._parse(new sx(s,e,s.path,t)));return s.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new rt({...this._def,minSize:{value:e,message:af.toString(t)}})}max(e,t){return new rt({...this._def,maxSize:{value:e,message:af.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}rt.create=(e,t)=>new rt({valueType:e,minSize:null,maxSize:null,typeName:am.ZodSet,...sS(t)});class rs extends sO{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==ss.function)return sp(t,{code:sn.invalid_type,expected:ss.function,received:t.parsedType}),sm;function s(e,s){return su({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,sl,so].filter(e=>!!e),issueData:{code:sn.invalid_arguments,argumentsError:s}})}function r(e,s){return su({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,sl,so].filter(e=>!!e),issueData:{code:sn.invalid_return_type,returnTypeError:s}})}let n={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof rl){let e=this;return sy(async function(...t){let i=new si([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(s(t,e)),i}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(r(l,e)),i})})}{let e=this;return sy(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new si([s(t,i.error)]);let o=Reflect.apply(a,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new si([r(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new rs({...this._def,args:s8.create(e).rest(sQ.create())})}returns(e){return new rs({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new rs({args:e||s8.create([]).rest(sQ.create()),returns:t||sQ.create(),typeName:am.ZodFunction,...sS(s)})}}class rr extends sO{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}rr.create=(e,t)=>new rr({getter:e,typeName:am.ZodLazy,...sS(t)});class rn extends sO{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return sp(t,{received:t.data,code:sn.invalid_literal,expected:this._def.value}),sm}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ra(e,t){return new ri({values:e,typeName:am.ZodEnum,...sS(t)})}rn.create=(e,t)=>new rn({value:e,typeName:am.ZodLiteral,...sS(t)});class ri extends sO{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),s=this._def.values;return sp(t,{expected:ah.joinValues(s),received:t.parsedType,code:sn.invalid_type}),sm}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return sp(t,{received:t.data,code:sn.invalid_enum_value,options:s}),sm}return sy(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ri.create(e,{...this._def,...t})}exclude(e,t=this._def){return ri.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}ri.create=ra;class ro extends sO{_parse(e){let t=ah.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==ss.string&&s.parsedType!==ss.number){let e=ah.objectValues(t);return sp(s,{expected:ah.joinValues(e),received:s.parsedType,code:sn.invalid_type}),sm}if(this._cache||(this._cache=new Set(ah.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=ah.objectValues(t);return sp(s,{received:s.data,code:sn.invalid_enum_value,options:e}),sm}return sy(e.data)}get enum(){return this._def.values}}ro.create=(e,t)=>new ro({values:e,typeName:am.ZodNativeEnum,...sS(t)});class rl extends sO{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==ss.promise&&!1===t.common.async?(sp(t,{code:sn.invalid_type,expected:ss.promise,received:t.parsedType}),sm):sy((t.parsedType===ss.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}rl.create=(e,t)=>new rl({type:e,typeName:am.ZodPromise,...sS(t)});class rc extends sO{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===am.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),r=this._def.effect||null,n={addIssue:e=>{sp(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===r.type){let e=r.transform(s.data,n);if(s.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return sm;let r=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===r.status?sm:"dirty"===r.status||"dirty"===t.value?sg(r.value):r});{if("aborted"===t.value)return sm;let r=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===r.status?sm:"dirty"===r.status||"dirty"===t.value?sg(r.value):r}}if("refinement"===r.type){let e=e=>{let t=r.refinement(e,n);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(s=>"aborted"===s.status?sm:("dirty"===s.status&&t.dirty(),e(s.value).then(()=>({status:t.value,value:s.value}))));{let r=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===r.status?sm:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}}if("transform"===r.type)if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(e=>sb(e)?Promise.resolve(r.transform(e.value,n)).then(e=>({status:t.value,value:e})):sm);else{let e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!sb(e))return sm;let a=r.transform(e.value,n);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}ah.assertNever(r)}}rc.create=(e,t,s)=>new rc({schema:e,typeName:am.ZodEffects,effect:t,...sS(s)}),rc.createWithPreprocess=(e,t,s)=>new rc({schema:t,effect:{type:"preprocess",transform:e},typeName:am.ZodEffects,...sS(s)});class rd extends sO{_parse(e){return this._getType(e)===ss.undefined?sy(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}rd.create=(e,t)=>new rd({innerType:e,typeName:am.ZodOptional,...sS(t)});class ru extends sO{_parse(e){return this._getType(e)===ss.null?sy(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ru.create=(e,t)=>new ru({innerType:e,typeName:am.ZodNullable,...sS(t)});class rh extends sO{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===ss.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}rh.create=(e,t)=>new rh({innerType:e,typeName:am.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...sS(t)});class rp extends sO{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return sw(r)?r.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new si(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new si(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}rp.create=(e,t)=>new rp({innerType:e,typeName:am.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...sS(t)});class rf extends sO{_parse(e){if(this._getType(e)!==ss.nan){let t=this._getOrReturnCtx(e);return sp(t,{code:sn.invalid_type,expected:ss.nan,received:t.parsedType}),sm}return{status:"valid",value:e.data}}}rf.create=e=>new rf({typeName:am.ZodNaN,...sS(e)});let rm=Symbol("zod_brand");class rg extends sO{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class ry extends sO{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?sm:"dirty"===e.status?(t.dirty(),sg(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})();{let e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?sm:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new ry({in:e,out:t,typeName:am.ZodPipeline})}}class r_ extends sO{_parse(e){let t=this._def.innerType._parse(e),s=e=>(sb(e)&&(e.value=Object.freeze(e.value)),e);return sw(t)?t.then(e=>s(e)):s(t)}unwrap(){return this._def.innerType}}function rv(e,t){let s="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof s?{message:s}:s}function rb(e,t={},s){return e?sG.create().superRefine((r,n)=>{let a=e(r);if(a instanceof Promise)return a.then(e=>{if(!e){let e=rv(t,r),a=e.fatal??s??!0;n.addIssue({code:"custom",...e,fatal:a})}});if(!a){let e=rv(t,r),a=e.fatal??s??!0;n.addIssue({code:"custom",...e,fatal:a})}}):sG.create()}r_.create=(e,t)=>new r_({innerType:e,typeName:am.ZodReadonly,...sS(t)});let rw={object:s4.lazycreate};(r7=am||(am={})).ZodString="ZodString",r7.ZodNumber="ZodNumber",r7.ZodNaN="ZodNaN",r7.ZodBigInt="ZodBigInt",r7.ZodBoolean="ZodBoolean",r7.ZodDate="ZodDate",r7.ZodSymbol="ZodSymbol",r7.ZodUndefined="ZodUndefined",r7.ZodNull="ZodNull",r7.ZodAny="ZodAny",r7.ZodUnknown="ZodUnknown",r7.ZodNever="ZodNever",r7.ZodVoid="ZodVoid",r7.ZodArray="ZodArray",r7.ZodObject="ZodObject",r7.ZodUnion="ZodUnion",r7.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r7.ZodIntersection="ZodIntersection",r7.ZodTuple="ZodTuple",r7.ZodRecord="ZodRecord",r7.ZodMap="ZodMap",r7.ZodSet="ZodSet",r7.ZodFunction="ZodFunction",r7.ZodLazy="ZodLazy",r7.ZodLiteral="ZodLiteral",r7.ZodEnum="ZodEnum",r7.ZodEffects="ZodEffects",r7.ZodNativeEnum="ZodNativeEnum",r7.ZodOptional="ZodOptional",r7.ZodNullable="ZodNullable",r7.ZodDefault="ZodDefault",r7.ZodCatch="ZodCatch",r7.ZodPromise="ZodPromise",r7.ZodBranded="ZodBranded",r7.ZodPipeline="ZodPipeline",r7.ZodReadonly="ZodReadonly";let rx=(e,t={message:`Input not instance of ${e.name}`})=>rb(t=>t instanceof e,t),rk=sq.create,rS=sz.create,rO=rf.create,rA=sK.create,r$=sV.create,rI=sJ.create,rT=sH.create,rR=sX.create,rE=sY.create,rC=sG.create,rP=sQ.create,rj=s0.create,rN=s1.create,rZ=s2.create,rM=s4.create,rL=s4.strictCreate,rD=s9.create,rB=s5.create,rF=s6.create,rU=s8.create,rW=s7.create,rq=re.create,rz=rt.create,rK=rs.create,rV=rr.create,rJ=rn.create,rH=ri.create,rX=ro.create,rY=rl.create,rG=rc.create,rQ=rd.create,r0=ru.create,r1=rc.createWithPreprocess,r2=ry.create,r4=()=>rk().optional(),r9=()=>rS().optional(),r3=()=>r$().optional(),r5={string:e=>sq.create({...e,coerce:!0}),number:e=>sz.create({...e,coerce:!0}),boolean:e=>sV.create({...e,coerce:!0}),bigint:e=>sK.create({...e,coerce:!0}),date:e=>sJ.create({...e,coerce:!0})};e.s(["BRAND",0,rm,"NEVER",0,sm,"Schema",()=>sO,"ZodAny",()=>sG,"ZodArray",()=>s2,"ZodBigInt",()=>sK,"ZodBoolean",()=>sV,"ZodBranded",()=>rg,"ZodCatch",()=>rp,"ZodDate",()=>sJ,"ZodDefault",()=>rh,"ZodDiscriminatedUnion",()=>s5,"ZodEffects",()=>rc,"ZodEnum",()=>ri,"ZodFirstPartyTypeKind",()=>am,"ZodFunction",()=>rs,"ZodIntersection",()=>s6,"ZodLazy",()=>rr,"ZodLiteral",()=>rn,"ZodMap",()=>re,"ZodNaN",()=>rf,"ZodNativeEnum",()=>ro,"ZodNever",()=>s0,"ZodNull",()=>sY,"ZodNullable",()=>ru,"ZodNumber",()=>sz,"ZodObject",()=>s4,"ZodOptional",()=>rd,"ZodPipeline",()=>ry,"ZodPromise",()=>rl,"ZodReadonly",()=>r_,"ZodRecord",()=>s7,"ZodSchema",()=>sO,"ZodSet",()=>rt,"ZodString",()=>sq,"ZodSymbol",()=>sH,"ZodTransformer",()=>rc,"ZodTuple",()=>s8,"ZodType",()=>sO,"ZodUndefined",()=>sX,"ZodUnion",()=>s9,"ZodUnknown",()=>sQ,"ZodVoid",()=>s1,"any",()=>rC,"array",()=>rZ,"bigint",()=>rA,"boolean",()=>r$,"coerce",0,r5,"custom",()=>rb,"date",()=>rI,"datetimeRegex",()=>sW,"discriminatedUnion",()=>rB,"effect",()=>rG,"enum",()=>rH,"function",()=>rK,"instanceof",()=>rx,"intersection",()=>rF,"late",0,rw,"lazy",()=>rV,"literal",()=>rJ,"map",()=>rq,"nan",()=>rO,"nativeEnum",()=>rX,"never",()=>rj,"null",()=>rE,"nullable",()=>r0,"number",()=>rS,"object",()=>rM,"oboolean",()=>r3,"onumber",()=>r9,"optional",()=>rQ,"ostring",()=>r4,"pipeline",()=>r2,"preprocess",()=>r1,"promise",()=>rY,"record",()=>rW,"set",()=>rz,"strictObject",()=>rL,"string",()=>rk,"symbol",()=>rT,"transformer",()=>rG,"tuple",()=>rU,"undefined",()=>rR,"union",()=>rD,"unknown",()=>rP,"void",()=>rN],17958),e.i(17958),e.i(15235),e.s(["BRAND",0,rm,"DIRTY",0,sg,"EMPTY_PATH",0,sh,"INVALID",0,sm,"NEVER",0,sm,"OK",0,sy,"ParseStatus",()=>sf,"Schema",()=>sO,"ZodAny",()=>sG,"ZodArray",()=>s2,"ZodBigInt",()=>sK,"ZodBoolean",()=>sV,"ZodBranded",()=>rg,"ZodCatch",()=>rp,"ZodDate",()=>sJ,"ZodDefault",()=>rh,"ZodDiscriminatedUnion",()=>s5,"ZodEffects",()=>rc,"ZodEnum",()=>ri,"ZodError",()=>si,"ZodFirstPartyTypeKind",()=>am,"ZodFunction",()=>rs,"ZodIntersection",()=>s6,"ZodIssueCode",0,sn,"ZodLazy",()=>rr,"ZodLiteral",()=>rn,"ZodMap",()=>re,"ZodNaN",()=>rf,"ZodNativeEnum",()=>ro,"ZodNever",()=>s0,"ZodNull",()=>sY,"ZodNullable",()=>ru,"ZodNumber",()=>sz,"ZodObject",()=>s4,"ZodOptional",()=>rd,"ZodParsedType",0,ss,"ZodPipeline",()=>ry,"ZodPromise",()=>rl,"ZodReadonly",()=>r_,"ZodRecord",()=>s7,"ZodSchema",()=>sO,"ZodSet",()=>rt,"ZodString",()=>sq,"ZodSymbol",()=>sH,"ZodTransformer",()=>rc,"ZodTuple",()=>s8,"ZodType",()=>sO,"ZodUndefined",()=>sX,"ZodUnion",()=>s9,"ZodUnknown",()=>sQ,"ZodVoid",()=>s1,"addIssueToContext",()=>sp,"any",()=>rC,"array",()=>rZ,"bigint",()=>rA,"boolean",()=>r$,"coerce",0,r5,"custom",()=>rb,"date",()=>rI,"datetimeRegex",()=>sW,"defaultErrorMap",0,so,"discriminatedUnion",()=>rB,"effect",()=>rG,"enum",()=>rH,"function",()=>rK,"getErrorMap",()=>sd,"getParsedType",0,sr,"instanceof",()=>rx,"intersection",()=>rF,"isAborted",0,s_,"isAsync",0,sw,"isDirty",0,sv,"isValid",0,sb,"late",0,rw,"lazy",()=>rV,"literal",()=>rJ,"makeIssue",0,su,"map",()=>rq,"nan",()=>rO,"nativeEnum",()=>rX,"never",()=>rj,"null",()=>rE,"nullable",()=>r0,"number",()=>rS,"object",()=>rM,"objectUtil",()=>ap,"oboolean",()=>r3,"onumber",()=>r9,"optional",()=>rQ,"ostring",()=>r4,"pipeline",()=>r2,"preprocess",()=>r1,"promise",()=>rY,"quotelessJson",0,sa,"record",()=>rW,"set",()=>rz,"setErrorMap",()=>sc,"strictObject",()=>rL,"string",()=>rk,"symbol",()=>rT,"transformer",()=>rG,"tuple",()=>rU,"undefined",()=>rR,"union",()=>rD,"unknown",()=>rP,"util",()=>ah,"void",()=>rN],35907);var r6,r8,r7,ne,nt,ns,nr,nn,na,ni,no,nl,nc,nd,nu,nh,np,nf,nm,ng,ny,n_,nv,nb,nw,nx,nk,nS,nO,nA,n$,nI,nT,nR,nE,nC,nP,nj,nN,nZ,nM,nL,nD,nB,nF,nU,nW,nq,nz,nK,nV,nJ,nH,nX,nY,nG,nQ,n0,n1,n2,n4,n9,n3,n5,n6,n8,n7,ae,at,as,ar,an,aa,ai,ao,al,ac,ad,au,ah,ap,af,am,ag=e.i(35907),ag=ag;let ay=ag.object({type:ag.literal("text"),id:ag.string(),html:ag.string().default(""),style:ag.any().optional()}),a_=ag.object({type:ag.literal("image"),id:ag.string(),src:ag.string().default(""),alt:ag.string().optional()}),av=ag.object({type:ag.literal("video"),id:ag.string(),src:ag.string().default("")}),ab=ag.object({id:ag.string(),label:ag.string(),correct:ag.boolean().optional()}),aw=ag.object({type:ag.literal("quiz"),id:ag.string(),question:ag.string().default(""),questionHtml:ag.string().optional(),questionStyle:ag.any().optional(),options:ag.array(ab).default([]),style:ag.any().optional(),optionStyle:ag.any().optional()}),ax=ag.object({type:ag.literal("interactive"),id:ag.string(),variant:ag.enum(["button","callout","reveal","custom"]).default("button"),label:ag.string().default("Interactive element"),url:ag.string().optional(),bodyHtml:ag.string().optional(),initiallyOpen:ag.boolean().optional(),tone:ag.enum(["info","success","warning","danger"]).optional(),style:ag.any().optional()}),ak=ag.discriminatedUnion("type",[ay,a_,av,aw,ax]),aS=ag.object({id:ag.string(),title:ag.string().default("Untitled Page"),blocks:ag.array(ak).default([])}),aO=ag.object({id:ag.string().default(()=>`proj-${Date.now()}`),title:ag.string().default("Untitled Lesson"),version:ag.enum(["1.2","2004"]).optional().default("1.2"),theme:ag.object({direction:ag.enum(["ltr","rtl"]).default("ltr"),styles:ag.any().default({})}),tracking:ag.object({level:ag.enum(["minimal","standard","advanced"]).default("standard"),pageViews:ag.boolean().default(!0),quizInteractions:ag.boolean().default(!0),media:ag.boolean().default(!0),hints:ag.boolean().default(!1),externalLinks:ag.boolean().default(!1),timePerPage:ag.boolean().default(!0),attempts:ag.boolean().default(!0)}),xapi:ag.object({lrsEndpoint:ag.string().default(""),authToken:ag.string().default(""),activityIdFormat:ag.string().default("iri"),statementExtensions:ag.string().default("{}")}),pages:ag.array(aS).default([])});async function aA(e){var t;let s,r=e.map(e=>({role:e.role,content:st(e.content)})),n=await t6(r),a=await t7(n),i=function(e){let t=e.split("\n").map(e=>e.trim()),s="Untitled Lesson",r=[],n=null;for(let e of t){if(e.startsWith("Lesson Title:")){s=e.replace("Lesson Title:","").trim();continue}if(e.startsWith("- Page")){n&&r.push(n),n={title:e.replace(/- Page \d+:\s*/i,"").trim()||"Untitled Page",blocks:[]};continue}if(e.startsWith("- Text:")){let t=e.replace("- Text:","").trim();n?.blocks.push({type:"text",content:t||""});continue}if(e.startsWith("- Image:")){let t=e.replace("- Image:","").trim();n?.blocks.push({type:"image",src:"",content:t});continue}if(e.startsWith("- Quiz:")){n?.blocks.push({type:"quiz",content:"quiz-placeholder"});continue}}return n&&r.push(n),{title:s,pages:r}}(await se(a));return{agent:"pipeline",content:"Lesson generated successfully.",project:(t={id:`proj-${crypto.randomUUID()}`,title:i.title,version:"1.2",theme:{direction:"ltr",styles:{}},tracking:{level:"standard",pageViews:!0,quizInteractions:!0,media:!0,hints:!1,externalLinks:!1,timePerPage:!0,attempts:!0},xapi:{lrsEndpoint:"",authToken:"",activityIdFormat:"iri",statementExtensions:"{}"},pages:i.pages.map(e=>({id:`page-${crypto.randomUUID()}`,title:e.title,blocks:e.blocks.map(e=>({id:`block-${crypto.randomUUID()}`,type:e.type,html:"text"===e.type?st(e.content||""):void 0,src:"image"===e.type?"":void 0,question:"quiz"===e.type?e.content||"":void 0,options:"quiz"===e.type?[]:void 0}))}))},(s=aO.safeParse(t)).success?s.data:(console.warn(" AI returned invalid JSON, applying fallback normalization."),console.warn(s.error.format()),aO.parse({}))),warnings:[],metadata:{predictedDifficulty:"medium",recommendedTags:[],routerSummary:"",routing:{}}}}ag.object({project:aO,warnings:ag.array(ag.string()).default([]),metadata:ag.object({predictedDifficulty:ag.enum(["easy","medium","hard"]).default("easy"),recommendedTags:ag.array(ag.string()).default([]),routerSummary:ag.string().default(""),routing:ag.any()})}),e.s(["runAIPipeline",()=>aA],67065)}];

//# sourceMappingURL=lib_ai_pipeline_ts_d2e2a1c6._.js.map