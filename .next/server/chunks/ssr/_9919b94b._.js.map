{"version":3,"sources":["../../../../components/ui/input.tsx","../../../../lib/user-profile.ts","../../../../app/profile/page.tsx","../../../../node_modules/lucide-react/src/icons/loader-circle.ts"],"sourcesContent":["import * as React from 'react'\r\n\r\nimport { cn } from '@/lib/utils'\r\n\r\nfunction Input({ className, type, ...props }: React.ComponentProps<'input'>) {\r\n  return (\r\n    <input\r\n      type={type}\r\n      data-slot=\"input\"\r\n      className={cn(\r\n        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\r\n        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',\r\n        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Input }\r\n","\"use client\";\r\n\r\nimport { createClient } from \"@/lib/supabase/client\";\r\n\r\nconst supabase = createClient();\r\n\r\nexport type UserProfileRow = {\r\n  user_id: string;\r\n  email: string | null;\r\n  full_name: string | null;\r\n  preferred_language: string | null;\r\n  avatar_url: string | null;\r\n  created_at: string;\r\n};\r\n\r\n// Load current user profile\r\nexport async function getUserProfile(userId: string) {\r\n  // RLS already limits to auth.uid(), so userId is mostly for clarity\r\n  const { data, error } = await supabase\r\n    .from(\"users\")\r\n    .select(\"user_id, email, full_name, preferred_language, avatar_url, created_at\")\r\n    .eq(\"user_id\", userId)\r\n    .single();\r\n\r\n  return { data, error };\r\n}\r\n\r\n// Update current user profile\r\nexport async function updateUserProfile(\r\n  userId: string,\r\n  updates: {\r\n    full_name?: string;\r\n    preferred_language?: string;\r\n    avatar_url?: string | null;\r\n  }\r\n) {\r\n  const { error } = await supabase\r\n    .from(\"users\")\r\n    .update({\r\n      full_name: updates.full_name,\r\n      preferred_language: updates.preferred_language,\r\n      avatar_url: updates.avatar_url ?? null,\r\n    })\r\n    .eq(\"user_id\", userId);\r\n\r\n  return { error };\r\n}\r\n","\"use client\"\r\n\r\nimport { useCallback, useEffect, useMemo, useState } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Loader2, User } from \"lucide-react\"\r\nimport { toast } from \"sonner\"\r\n\r\nimport { useSupabase } from \"@/components/auth-provider\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { getUserProfile, updateUserProfile } from \"@/lib/user-profile\"\r\n\r\nconst languageOptions = [\r\n  { label: \"English\", value: \"en\" },\r\n  { label: \"Arabic\", value: \"ar\" },\r\n]\r\n\r\nconst normalizeLanguage = (language: string) =>\r\n  language?.toLowerCase().startsWith(\"ar\") ? \"ar\" : \"en\"\r\n\r\ntype ProfileFormState = {\r\n  fullName: string\r\n  email: string\r\n  preferredLanguage: string\r\n}\r\n\r\nexport default function ProfilePage() {\r\n  return <PersonalInfoPanel />\r\n}\r\n\r\nfunction PersonalInfoPanel() {\r\n  const { user } = useSupabase()\r\n  const router = useRouter()\r\n  const [form, setForm] = useState<ProfileFormState>({\r\n    fullName: \"\",\r\n    email: \"\",\r\n    preferredLanguage: \"\",\r\n  })\r\n  const [loading, setLoading] = useState(true)\r\n  const [saving, setSaving] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const isLoggedOut = useMemo(() => !user, [user])\r\n\r\n  const loadProfile = useCallback(async () => {\r\n    if (!user) {\r\n      setLoading(false)\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n    setError(null)\r\n    const { data: profile, error } = await getUserProfile(user.id)\r\n    if (error) {\r\n      setError(\"Could not load your profile. Please try again.\")\r\n    } else if (profile) {\r\n      initializeForm(profile)\r\n    }\r\n    setLoading(false)\r\n  }, [user])\r\n\r\n  useEffect(() => {\r\n    loadProfile()\r\n  }, [loadProfile])\r\n\r\n  const initializeForm = (profile: {\r\n    full_name?: string | null\r\n    email?: string | null\r\n    preferred_language?: string | null\r\n  }) => {\r\n    setForm({\r\n      fullName: profile.full_name ?? \"\",\r\n      email: profile.email ?? user?.email ?? \"\",\r\n      preferredLanguage: normalizeLanguage(profile.preferred_language ?? \"en\"),\r\n    })\r\n  }\r\n\r\n  const handleInputChange =\r\n    (field: keyof ProfileFormState) =>\r\n    (event: React.ChangeEvent<HTMLInputElement>) => {\r\n      setForm((current) => ({ ...current, [field]: event.target.value }))\r\n    }\r\n\r\n  const handleSelectChange =\r\n    (field: keyof ProfileFormState) =>\r\n    (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n      setForm((current) => ({ ...current, [field]: event.target.value }))\r\n    }\r\n\r\n  const handleSave = async () => {\r\n    if (!user) {\r\n      setError(\"You must be logged in to update your profile.\")\r\n      return\r\n    }\r\n\r\n    setSaving(true)\r\n    setError(null)\r\n\r\n    const { error } = await updateUserProfile(user.id, {\r\n      full_name: form.fullName,\r\n      preferred_language: normalizeLanguage(form.preferredLanguage || \"en\"),\r\n    })\r\n\r\n    setSaving(false)\r\n\r\n    if (error) {\r\n      setError(\"Failed to save your changes. Please try again.\")\r\n      return\r\n    }\r\n\r\n    toast.success(\"Profile updated\")\r\n    await loadProfile()\r\n    router.refresh()\r\n  }\r\n\r\n  if (isLoggedOut) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <h2 className=\"text-2xl font-bold text-foreground\">Profile</h2>\r\n        <p className=\"text-muted-foreground\">\r\n          Please sign in to view your profile.\r\n        </p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        <h2 className=\"text-2xl font-bold text-foreground\">Profile</h2>\r\n        <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n          <span>Syncing your profile with the database...</span>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-2xl font-bold text-foreground mb-6\">\r\n          Personal Information\r\n        </h2>\r\n\r\n        {/* Avatar */}\r\n        <div className=\"mb-8\">\r\n          <label className=\"block text-sm font-semibold text-foreground mb-2\">\r\n            Profile Picture\r\n          </label>\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center\">\r\n              <User className=\"h-10 w-10 text-primary\" />\r\n            </div>\r\n            <Button variant=\"outline\" size=\"sm\" disabled>\r\n              Upload Photo\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <div className=\"grid md:grid-cols-2 gap-6\">\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-foreground mb-2\">\r\n              Full Name\r\n            </label>\r\n            <Input\r\n              value={form.fullName}\r\n              onChange={handleInputChange(\"fullName\")}\r\n              disabled={loading}\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-semibold text-foreground mb-2\">\r\n              Email\r\n            </label>\r\n            <Input value={form.email} type=\"email\" disabled />\r\n          </div>\r\n          <div className=\"md:col-span-2\">\r\n            <label className=\"block text-sm font-semibold text-foreground mb-2\">\r\n              Preferred Language\r\n            </label>\r\n            <select\r\n              className=\"w-full px-3 py-2 rounded-lg border border-input bg-background text-sm\"\r\n              value={form.preferredLanguage}\r\n              onChange={handleSelectChange(\"preferredLanguage\")}\r\n              disabled={loading}\r\n            >\r\n              <option value=\"\" disabled>\r\n                Select a language\r\n              </option>\r\n              {languageOptions.map((language) => (\r\n                <option key={language.value} value={language.value}>\r\n                  {language.label}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        {error && <p className=\"text-sm text-destructive pt-2\">{error}</p>}\r\n\r\n        <div className=\"pt-6\">\r\n          <Button onClick={handleSave} disabled={loading || saving}>\r\n            {saving ? \"Saving...\" : \"Save Changes\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name LoaderCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTJhOSA5IDAgMSAxLTYuMjE5LTguNTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/loader-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst LoaderCircle = createLucideIcon('LoaderCircle', [\n  ['path', { d: 'M21 12a9 9 0 1 1-6.219-8.56', key: '13zald' }],\n]);\n\nexport default LoaderCircle;\n"],"names":[],"mappings":"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","ignoreList":[3]}